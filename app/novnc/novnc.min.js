var noVNC=function(){"use strict";let e="warn",t=()=>{},s=()=>{},i=()=>{},n=()=>{};!function(r){if(void 0===r?r=e:e=r,t=s=i=n=()=>{},void 0!==window.console)switch(r){case"debug":t=console.debug.bind(window.console);case"info":s=console.info.bind(window.console);case"warn":i=console.warn.bind(window.console);case"error":n=console.error.bind(window.console);case"none":break;default:throw new n("invalid logging type '"+r+"'")}}();let r="ontouchstart"in document.documentElement||void 0!==document.ontouchstart||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;window.addEventListener("touchstart",(function e(){r=!0,window.removeEventListener("touchstart",e,!1)}),!1);let o=10*(window.devicePixelRatio||1),a=null;function h(){return navigator&&!!/mac/i.exec(navigator.platform)}function c(){return navigator&&!!/trident/i.exec(navigator.userAgent)}function l(){return navigator&&!!/edge/i.exec(navigator.userAgent)}function _(){return navigator&&!!/firefox/i.exec(navigator.userAgent)}function d(){return navigator&&!!/win/i.exec(navigator.platform)}var u={toBase64Table:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),base64Pad:"=",encode(e){let t="";const s=e.length,i=s%3;for(let i=0;i<s-2;i+=3)t+=this.toBase64Table[e[i]>>2],t+=this.toBase64Table[((3&e[i])<<4)+(e[i+1]>>4)],t+=this.toBase64Table[((15&e[i+1])<<2)+(e[i+2]>>6)],t+=this.toBase64Table[63&e[i+2]];const n=s-i;return 2===i?(t+=this.toBase64Table[e[n]>>2],t+=this.toBase64Table[((3&e[n])<<4)+(e[n+1]>>4)],t+=this.toBase64Table[(15&e[n+1])<<2],t+=this.toBase64Table[64]):1===i&&(t+=this.toBase64Table[e[n]>>2],t+=this.toBase64Table[(3&e[n])<<4],t+=this.toBase64Table[64],t+=this.toBase64Table[64]),t},toBinaryTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],decode(e,t){t=void 0!==t?t:0;let s=e.indexOf("=")-t;s<0&&(s=e.length-t);const i=3*(s>>2)+Math.floor(s%4/1.5),r=new Array(i);let o=0,a=0;for(let s=0,i=t;i<e.length;i++){const t=this.toBinaryTable[127&e.charCodeAt(i)],h=e.charAt(i)===this.base64Pad;-1!==t?(a=a<<6|t,o+=6,o>=8&&(o-=8,h||(r[s++]=a>>o&255),a&=(1<<o)-1)):n("Illegal character code "+e.charCodeAt(i)+" at position "+i)}if(o){const e=new Error("Corrupted base64 string");throw e.name="Base64-Error",e}return r}};let f=!1;try{new ImageData(new Uint8ClampedArray(4),1,1),f=!0}catch(e){}class p{constructor(e){if(this._drawCtx=null,this._c_forceCanvas=!1,this._renderQ=[],this._flushing=!1,this._fb_width=0,this._fb_height=0,this._prevDrawStyle="",this._tile=null,this._tile16x16=null,this._tile_x=0,this._tile_y=0,t(">> Display.constructor"),this._target=e,!this._target)throw new Error("Target must be set");if("string"==typeof this._target)throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");if(this._targetCtx=this._target.getContext("2d"),this._viewportLoc={x:0,y:0,w:this._target.width,h:this._target.height},this._backbuffer=document.createElement("canvas"),this._drawCtx=this._backbuffer.getContext("2d"),this._damageBounds={left:0,top:0,right:this._backbuffer.width,bottom:this._backbuffer.height},t("User Agent: "+navigator.userAgent),this.clear(),!("createImageData"in this._drawCtx))throw new Error("Canvas does not support createImageData");this._tile16x16=this._drawCtx.createImageData(16,16),t("<< Display.constructor"),this._scale=1,this._clipViewport=!1,this.logo=null,this.onflush=()=>{}}get scale(){return this._scale}set scale(e){this._rescale(e)}get clipViewport(){return this._clipViewport}set clipViewport(e){this._clipViewport=e;const t=this._viewportLoc;this.viewportChangeSize(t.w,t.h),this.viewportChangePos(0,0)}get width(){return this._fb_width}get height(){return this._fb_height}viewportChangePos(e,s){const i=this._viewportLoc;e=Math.floor(e),s=Math.floor(s),this._clipViewport||(e=-i.w,s=-i.h);const n=i.x+i.w-1,r=i.y+i.h-1;e<0&&i.x+e<0&&(e=-i.x),n+e>=this._fb_width&&(e-=n+e-this._fb_width+1),i.y+s<0&&(s=-i.y),r+s>=this._fb_height&&(s-=r+s-this._fb_height+1),0===e&&0===s||(t("viewportChange deltaX: "+e+", deltaY: "+s),i.x+=e,i.y+=s,this._damage(i.x,i.y,i.w,i.h),this.flip())}viewportChangeSize(e,s){this._clipViewport&&void 0!==e&&void 0!==s||(t("Setting viewport to full display region"),e=this._fb_width,s=this._fb_height),e=Math.floor(e),s=Math.floor(s),e>this._fb_width&&(e=this._fb_width),s>this._fb_height&&(s=this._fb_height);const i=this._viewportLoc;if(i.w!==e||i.h!==s){i.w=e,i.h=s;const t=this._target;t.width=e,t.height=s,this.viewportChangePos(0,0),this._damage(i.x,i.y,i.w,i.h),this.flip(),this._rescale(this._scale)}}absX(e){return e/this._scale+this._viewportLoc.x}absY(e){return e/this._scale+this._viewportLoc.y}resize(e,t){this._prevDrawStyle="",this._fb_width=e,this._fb_height=t;const s=this._backbuffer;if(s.width!==e||s.height!==t){let i=null;s.width>0&&s.height>0&&(i=this._drawCtx.getImageData(0,0,s.width,s.height)),s.width!==e&&(s.width=e),s.height!==t&&(s.height=t),i&&this._drawCtx.putImageData(i,0,0)}const i=this._viewportLoc;this.viewportChangeSize(i.w,i.h),this.viewportChangePos(0,0)}_damage(e,t,s,i){e<this._damageBounds.left&&(this._damageBounds.left=e),t<this._damageBounds.top&&(this._damageBounds.top=t),e+s>this._damageBounds.right&&(this._damageBounds.right=e+s),t+i>this._damageBounds.bottom&&(this._damageBounds.bottom=t+i)}flip(e){if(0===this._renderQ.length||e){let e=this._damageBounds.left,t=this._damageBounds.top,s=this._damageBounds.right-e,i=this._damageBounds.bottom-t,n=e-this._viewportLoc.x,r=t-this._viewportLoc.y;n<0&&(s+=n,e-=n,n=0),r<0&&(i+=r,t-=r,r=0),n+s>this._viewportLoc.w&&(s=this._viewportLoc.w-n),r+i>this._viewportLoc.h&&(i=this._viewportLoc.h-r),s>0&&i>0&&this._targetCtx.drawImage(this._backbuffer,e,t,s,i,n,r,s,i),this._damageBounds.left=this._damageBounds.top=65535,this._damageBounds.right=this._damageBounds.bottom=0}else this._renderQ_push({type:"flip"})}clear(){this._logo?(this.resize(this._logo.width,this._logo.height),this.imageRect(0,0,this._logo.type,this._logo.data)):(this.resize(240,20),this._drawCtx.clearRect(0,0,this._fb_width,this._fb_height)),this.flip()}pending(){return this._renderQ.length>0}flush(){0===this._renderQ.length?this.onflush():this._flushing=!0}fillRect(e,t,s,i,n,r){0===this._renderQ.length||r?(this._setFillColor(n),this._drawCtx.fillRect(e,t,s,i),this._damage(e,t,s,i)):this._renderQ_push({type:"fill",x:e,y:t,width:s,height:i,color:n})}copyImage(e,t,s,i,n,r,o){0===this._renderQ.length||o?(this._drawCtx.mozImageSmoothingEnabled=!1,this._drawCtx.webkitImageSmoothingEnabled=!1,this._drawCtx.msImageSmoothingEnabled=!1,this._drawCtx.imageSmoothingEnabled=!1,this._drawCtx.drawImage(this._backbuffer,e,t,n,r,s,i,n,r),this._damage(s,i,n,r)):this._renderQ_push({type:"copy",old_x:e,old_y:t,x:s,y:i,width:n,height:r})}imageRect(e,t,s,i){const n=new Image;n.src="data: "+s+";base64,"+u.encode(i),this._renderQ_push({type:"img",img:n,x:e,y:t})}startTile(e,t,s,i,n){this._tile_x=e,this._tile_y=t,this._tile=16===s&&16===i?this._tile16x16:this._drawCtx.createImageData(s,i);const r=n[2],o=n[1],a=n[0],h=this._tile.data;for(let e=0;e<s*i*4;e+=4)h[e]=r,h[e+1]=o,h[e+2]=a,h[e+3]=255}subTile(e,t,s,i,n){const r=n[2],o=n[1],a=n[0],h=e+s,c=t+i,l=this._tile.data,_=this._tile.width;for(let s=t;s<c;s++)for(let t=e;t<h;t++){const e=4*(t+s*_);l[e]=r,l[e+1]=o,l[e+2]=a,l[e+3]=255}}finishTile(){this._drawCtx.putImageData(this._tile,this._tile_x,this._tile_y),this._damage(this._tile_x,this._tile_y,this._tile.width,this._tile.height)}blitImage(e,t,s,i,n,r,o){if(0===this._renderQ.length||o)this._bgrxImageData(e,t,s,i,n,r);else{const r=new Uint8Array(s*i*4);r.set(new Uint8Array(n.buffer,0,r.length)),this._renderQ_push({type:"blit",data:r,x:e,y:t,width:s,height:i})}}blitRgbImage(e,t,s,i,n,r,o){if(0===this._renderQ.length||o)this._rgbImageData(e,t,s,i,n,r);else{const r=new Uint8Array(s*i*3);r.set(new Uint8Array(n.buffer,0,r.length)),this._renderQ_push({type:"blitRgb",data:r,x:e,y:t,width:s,height:i})}}blitRgbxImage(e,t,s,i,n,r,o){if(0===this._renderQ.length||o)this._rgbxImageData(e,t,s,i,n,r);else{const r=new Uint8Array(s*i*4);r.set(new Uint8Array(n.buffer,0,r.length)),this._renderQ_push({type:"blitRgbx",data:r,x:e,y:t,width:s,height:i})}}drawImage(e,t,s){this._drawCtx.drawImage(e,t,s),this._damage(t,s,e.width,e.height)}autoscale(e,t){const s=this._viewportLoc,i=e/t;let n;n=s.w/s.h>=i?e/s.w:t/s.h,this._rescale(n)}_rescale(e){this._scale=e;const t=this._viewportLoc,s=e*t.w+"px",i=e*t.h+"px";this._target.style.width===s&&this._target.style.height===i||(this._target.style.width=s,this._target.style.height=i)}_setFillColor(e){const t="rgb("+e[2]+","+e[1]+","+e[0]+")";t!==this._prevDrawStyle&&(this._drawCtx.fillStyle=t,this._prevDrawStyle=t)}_rgbImageData(e,t,s,i,n,r){const o=this._drawCtx.createImageData(s,i),a=o.data;for(let e=0,t=r;e<s*i*4;e+=4,t+=3)a[e]=n[t],a[e+1]=n[t+1],a[e+2]=n[t+2],a[e+3]=255;this._drawCtx.putImageData(o,e,t),this._damage(e,t,o.width,o.height)}_bgrxImageData(e,t,s,i,n,r){const o=this._drawCtx.createImageData(s,i),a=o.data;for(let e=0,t=r;e<s*i*4;e+=4,t+=4)a[e]=n[t+2],a[e+1]=n[t+1],a[e+2]=n[t],a[e+3]=255;this._drawCtx.putImageData(o,e,t),this._damage(e,t,o.width,o.height)}_rgbxImageData(e,t,s,i,n,r){let o;f?o=new ImageData(new Uint8ClampedArray(n.buffer,n.byteOffset,s*i*4),s,i):(o=this._drawCtx.createImageData(s,i),o.data.set(new Uint8ClampedArray(n.buffer,n.byteOffset,s*i*4))),this._drawCtx.putImageData(o,e,t),this._damage(e,t,o.width,o.height)}_renderQ_push(e){this._renderQ.push(e),1===this._renderQ.length&&this._scan_renderQ()}_resume_renderQ(){this.removeEventListener("load",this._noVNC_display._resume_renderQ),this._noVNC_display._scan_renderQ()}_scan_renderQ(){let e=!0;for(;e&&this._renderQ.length>0;){const t=this._renderQ[0];switch(t.type){case"flip":this.flip(!0);break;case"copy":this.copyImage(t.old_x,t.old_y,t.x,t.y,t.width,t.height,!0);break;case"fill":this.fillRect(t.x,t.y,t.width,t.height,t.color,!0);break;case"blit":this.blitImage(t.x,t.y,t.width,t.height,t.data,0,!0);break;case"blitRgb":this.blitRgbImage(t.x,t.y,t.width,t.height,t.data,0,!0);break;case"blitRgbx":this.blitRgbxImage(t.x,t.y,t.width,t.height,t.data,0,!0);break;case"img":t.img.complete?this.drawImage(t.img,t.x,t.y):(t.img._noVNC_display=this,t.img.addEventListener("load",this._resume_renderQ),e=!1)}e&&this._renderQ.shift()}0===this._renderQ.length&&this._flushing&&(this._flushing=!1,this.onflush())}}function m(e){e.stopPropagation(),e.preventDefault()}let g=!1,w=null;function b(e){if(g)return;const t=new e.constructor(e.type,e);g=!0,w.dispatchEvent(t),g=!1,e.stopPropagation(),t.defaultPrevented&&e.preventDefault(),"mouseup"===e.type&&Q()}function v(){document.getElementById("noVNC_mouse_capture_elem").style.cursor=window.getComputedStyle(w).cursor}const y=new MutationObserver(v);let k=0;function Q(){if(document.releaseCapture)document.releaseCapture();else{if(!w)return;window.setTimeout((e=>{k===e&&(w=null)}),0,k),y.disconnect();document.getElementById("noVNC_mouse_capture_elem").style.display="none",window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",b)}}const C={256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,402:2294,466:16777681,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8361:3839,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8711:2245,8728:3018,8730:2262,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8756:2240,8764:2248,8771:2249,8773:16785992,8800:2237,8801:2255,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};var x={lookup(e){if(e>=32&&e<=255)return e;const t=C[e];return void 0!==t?t:16777216|e}},S={8:"Backspace",9:"Tab",10:"NumpadClear",12:"Numpad5",13:"Enter",16:"ShiftLeft",17:"ControlLeft",18:"AltLeft",19:"Pause",20:"CapsLock",21:"Lang1",25:"Lang2",27:"Escape",28:"Convert",29:"NonConvert",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",41:"Select",44:"PrintScreen",45:"Insert",46:"Delete",47:"Help",48:"Digit0",49:"Digit1",50:"Digit2",51:"Digit3",52:"Digit4",53:"Digit5",54:"Digit6",55:"Digit7",56:"Digit8",57:"Digit9",91:"MetaLeft",92:"MetaRight",93:"ContextMenu",95:"Sleep",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",106:"NumpadMultiply",107:"NumpadAdd",108:"NumpadDecimal",109:"NumpadSubtract",110:"NumpadDecimal",111:"NumpadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",144:"NumLock",145:"ScrollLock",166:"BrowserBack",167:"BrowserForward",168:"BrowserRefresh",169:"BrowserStop",170:"BrowserSearch",171:"BrowserFavorites",172:"BrowserHome",173:"AudioVolumeMute",174:"AudioVolumeDown",175:"AudioVolumeUp",176:"MediaTrackNext",177:"MediaTrackPrevious",178:"MediaStop",179:"MediaPlayPause",180:"LaunchMail",181:"MediaSelect",182:"LaunchApp1",183:"LaunchApp2",225:"AltRight"},A={Backspace:"Backspace",AltLeft:"Alt",AltRight:"Alt",CapsLock:"CapsLock",ContextMenu:"ContextMenu",ControlLeft:"Control",ControlRight:"Control",Enter:"Enter",MetaLeft:"Meta",MetaRight:"Meta",ShiftLeft:"Shift",ShiftRight:"Shift",Tab:"Tab",Delete:"Delete",End:"End",Help:"Help",Home:"Home",Insert:"Insert",PageDown:"PageDown",PageUp:"PageUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",ArrowUp:"ArrowUp",NumLock:"NumLock",NumpadBackspace:"Backspace",NumpadClear:"Clear",Escape:"Escape",F1:"F1",F2:"F2",F3:"F3",F4:"F4",F5:"F5",F6:"F6",F7:"F7",F8:"F8",F9:"F9",F10:"F10",F11:"F11",F12:"F12",F13:"F13",F14:"F14",F15:"F15",F16:"F16",F17:"F17",F18:"F18",F19:"F19",F20:"F20",F21:"F21",F22:"F22",F23:"F23",F24:"F24",F25:"F25",F26:"F26",F27:"F27",F28:"F28",F29:"F29",F30:"F30",F31:"F31",F32:"F32",F33:"F33",F34:"F34",F35:"F35",PrintScreen:"PrintScreen",ScrollLock:"ScrollLock",Pause:"Pause",BrowserBack:"BrowserBack",BrowserFavorites:"BrowserFavorites",BrowserForward:"BrowserForward",BrowserHome:"BrowserHome",BrowserRefresh:"BrowserRefresh",BrowserSearch:"BrowserSearch",BrowserStop:"BrowserStop",Eject:"Eject",LaunchApp1:"LaunchMyComputer",LaunchApp2:"LaunchCalendar",LaunchMail:"LaunchMail",MediaPlayPause:"MediaPlay",MediaStop:"MediaStop",MediaTrackNext:"MediaTrackNext",MediaTrackPrevious:"MediaTrackPrevious",Power:"Power",Sleep:"Sleep",AudioVolumeDown:"AudioVolumeDown",AudioVolumeMute:"AudioVolumeMute",AudioVolumeUp:"AudioVolumeUp",WakeUp:"WakeUp"},E=65288,F=65289,B=65291,L=65293,D=65299,T=65300,U=65307,M=65535,R=65312,I=65335,P=65340,H=65341,K=65342,N=65313,z=65314,V=65315,O=65316,W=65317,G=65318,X=65319,Y=65320,q=65321,j=65322,Z=65326,J=65327,$=65328,ee=65360,te=65361,se=65362,ie=65363,ne=65364,re=65365,oe=65366,ae=65367,he=65376,ce=65377,le=65378,_e=65379,de=65381,ue=65382,fe=65383,pe=65384,me=65385,ge=65386,we=65406,be=65407,ve=65408,ye=65421,ke=65429,Qe=65430,Ce=65431,xe=65432,Se=65433,Ae=65434,Ee=65435,Fe=65436,Be=65437,Le=65438,De=65439,Te=65469,Ue=65450,Me=65451,Re=65452,Ie=65453,Pe=65454,He=65455,Ke=65456,Ne=65457,ze=65458,Ve=65459,Oe=65460,We=65461,Ge=65462,Xe=65463,Ye=65464,qe=65465,je=65470,Ze=65471,Je=65472,$e=65473,et=65474,tt=65475,st=65476,it=65477,nt=65478,rt=65479,ot=65480,at=65481,ht=65482,ct=65483,lt=65484,_t=65485,dt=65486,ut=65487,ft=65488,pt=65489,mt=65490,gt=65491,wt=65492,bt=65493,vt=65494,yt=65495,kt=65496,Qt=65497,Ct=65498,xt=65499,St=65500,At=65501,Et=65502,Ft=65503,Bt=65504,Lt=65505,Dt=65506,Tt=65507,Ut=65508,Mt=65509,Rt=65513,It=65514,Pt=65515,Ht=65516,Kt=65027,Nt=65032,zt=65034,Vt=65036,Ot=65038,Wt=32,Gt=42,Xt=43,Yt=44,qt=45,jt=46,Zt=47,Jt=48,$t=49,es=50,ts=51,ss=52,is=53,ns=54,rs=55,os=56,as=57,hs=61,cs=65329,ls=65332,_s=65336,ds=269025026,us=269025027,fs=269025040,ps=269025041,ms=269025042,gs=269025043,ws=269025044,bs=269025045,vs=269025046,ys=269025047,ks=269025048,Qs=269025049,Cs=269025051,xs=269025052,Ss=269025053,As=269025056,Es=269025057,Fs=269025062,Bs=269025063,Ls=269025064,Ds=269025065,Ts=269025066,Us=269025067,Ms=269025068,Rs=269025069,Is=269025070,Ps=269025072,Hs=269025073,Ks=269025074,Ns=269025075,zs=269025083,Vs=269025086,Os=269025110,Ws=269025111,Gs=269025112,Xs=269025116,Ys=269025121,qs=269025128,js=269025131,Zs=269025133,Js=269025134,$s=269025138,ei=269025143,ti=269025147,si=269025148,ii=269025149,ni=269025161,ri=269025163,oi=269025164,ai=269025167,hi=269025168,ci=269025170,li=269025175,_i=269025177,di=269025178,ui=269025179,fi=269025192,pi=269025202,mi=269024802;const gi={};function wi(e,t){if(void 0===t)throw'Undefined keysym for key "'+e+'"';if(e in gi)throw'Duplicate entry for key "'+e+'"';gi[e]=[t,t,t,t]}function bi(e,t,s){if(void 0===t)throw'Undefined keysym for key "'+e+'"';if(void 0===s)throw'Undefined keysym for key "'+e+'"';if(e in gi)throw'Duplicate entry for key "'+e+'"';gi[e]=[t,t,s,t]}function vi(e,t,s){if(void 0===t)throw'Undefined keysym for key "'+e+'"';if(void 0===s)throw'Undefined keysym for key "'+e+'"';if(e in gi)throw'Duplicate entry for key "'+e+'"';gi[e]=[t,t,t,s]}function yi(e){if(e.code){switch(e.code){case"OSLeft":return"MetaLeft";case"OSRight":return"MetaRight"}return e.code}if("keypress"!==e.type&&e.keyCode in S){let t=S[e.keyCode];if(h()&&"ContextMenu"===t&&(t="MetaRight"),2===e.location)switch(t){case"ShiftLeft":return"ShiftRight";case"ControlLeft":return"ControlRight";case"AltLeft":return"AltRight"}if(3===e.location)switch(t){case"Delete":return"NumpadDecimal";case"Insert":return"Numpad0";case"End":return"Numpad1";case"ArrowDown":return"Numpad2";case"PageDown":return"Numpad3";case"ArrowLeft":return"Numpad4";case"ArrowRight":return"Numpad6";case"Home":return"Numpad7";case"ArrowUp":return"Numpad8";case"PageUp":return"Numpad9";case"Enter":return"NumpadEnter"}return t}return"Unidentified"}function ki(e){const t=function(e){if(void 0!==e.key){switch(e.key){case"Spacebar":return" ";case"Esc":return"Escape";case"Scroll":return"ScrollLock";case"Win":return"Meta";case"Apps":return"ContextMenu";case"Up":return"ArrowUp";case"Left":return"ArrowLeft";case"Right":return"ArrowRight";case"Down":return"ArrowDown";case"Del":return"Delete";case"Divide":return"/";case"Multiply":return"*";case"Subtract":return"-";case"Add":return"+";case"Decimal":return e.char}switch(e.key){case"OS":return"Meta"}switch(e.key){case"UIKeyInputUpArrow":return"ArrowUp";case"UIKeyInputDownArrow":return"ArrowDown";case"UIKeyInputLeftArrow":return"ArrowLeft";case"UIKeyInputRightArrow":return"ArrowRight";case"UIKeyInputEscape":return"Escape"}if(1!==e.key.length||!c()&&!l())return e.key}const t=yi(e);return t in A?A[t]:e.charCode?String.fromCharCode(e.charCode):"Unidentified"}(e);if("Unidentified"===t)return null;if(t in gi){let s=e.location;return"Meta"===t&&0===s&&(s=2),(void 0===s||s>3)&&(s=0),gi[t][s]}if(1!==t.length)return null;const s=t.charCodeAt();return s?x.lookup(s):null}bi("Alt",Rt,It),wi("AltGraph",Kt),wi("CapsLock",Mt),bi("Control",Tt,Ut),bi("Hyper",Pt,Ht),bi("Meta",Pt,Ht),wi("NumLock",be),wi("ScrollLock",T),bi("Shift",Lt,Dt),bi("Super",Pt,Ht),vi("Enter",L,ye),wi("Tab",F),vi(" ",Wt,ve),vi("ArrowDown",ne,Se),vi("ArrowUp",se,Ce),vi("ArrowLeft",te,Qe),vi("ArrowRight",ie,xe),vi("End",ae,Fe),vi("Home",ee,ke),vi("PageDown",oe,Ee),vi("PageUp",re,Ae),wi("Backspace",E),vi("Clear",B,Be),wi("Copy",Ws),wi("Cut",Gs),vi("Delete",M,De),vi("Insert",_e,Le),wi("Paste",Zs),wi("Redo",ue),wi("Undo",de),wi("Cancel",me),wi("ContextMenu",fe),wi("Escape",U),wi("Execute",le),wi("Find",pe),wi("Help",ge),wi("Pause",D),wi("Select",he),wi("ZoomIn",ri),wi("ZoomOut",oi),wi("BrightnessDown",us),wi("BrightnessUp",ds),wi("Eject",Ms),wi("LogOff",Ys),wi("Power",Ts),wi("PowerOff",Es),wi("PrintScreen",ce),wi("Hibernate",fi),wi("Standby",fs),wi("WakeUp",Us),wi("AllCandidates",H),wi("Alphanumeric",J),wi("CodeInput",I),wi("Compose",R),wi("Convert",V),wi("GroupFirst",Vt),wi("GroupLast",Ot),wi("GroupNext",Nt),wi("GroupPrevious",zt),wi("NonConvert",z),wi("PreviousCandidate",K),wi("SingleCandidate",P),wi("HangulMode",cs),wi("HanjaMode",ls),wi("JunjuaMode",_s),wi("Eisu",$),wi("Hankaku",q),wi("Hiragana",W),wi("HiraganaKatakana",X),wi("KanaMode",Z),wi("KanjiMode",N),wi("Katakana",G),wi("Romaji",O),wi("Zenkaku",Y),wi("ZenkakuHanaku",j),wi("F1",je),wi("F2",Ze),wi("F3",Je),wi("F4",$e),wi("F5",et),wi("F6",tt),wi("F7",st),wi("F8",it),wi("F9",nt),wi("F10",rt),wi("F11",ot),wi("F12",at),wi("F13",ht),wi("F14",ct),wi("F15",lt),wi("F16",_t),wi("F17",dt),wi("F18",ut),wi("F19",ft),wi("F20",pt),wi("F21",mt),wi("F22",gt),wi("F23",wt),wi("F24",bt),wi("F25",vt),wi("F26",yt),wi("F27",kt),wi("F28",Qt),wi("F29",Ct),wi("F30",xt),wi("F31",St),wi("F32",At),wi("F33",Et),wi("F34",Ft),wi("F35",Bt),wi("Close",Os),wi("MailForward",hi),wi("MailReply",$s),wi("MainSend",ti),wi("MediaFastForward",li),wi("MediaPause",Hs),wi("MediaPlay",ws),wi("MediaRecord",xs),wi("MediaRewind",Vs),wi("MediaStop",bs),wi("MediaTrackNext",ys),wi("MediaTrackPrevious",vs),wi("New",qs),wi("Open",js),wi("Print",ce),wi("Save",ei),wi("SpellCheck",si),wi("AudioVolumeDown",ps),wi("AudioVolumeUp",gs),wi("AudioVolumeMute",ms),wi("MicrophoneVolumeMute",pi),wi("LaunchCalculator",Ss),wi("LaunchCalendar",As),wi("LaunchMail",Qs),wi("LaunchMediaPlayer",Ks),wi("LaunchMusicPlayer",ci),wi("LaunchMyComputer",Ns),wi("LaunchPhone",Js),wi("LaunchScreenSaver",Rs),wi("LaunchSpreadsheet",Xs),wi("LaunchWebBrowser",Is),wi("LaunchWebCam",ai),wi("LaunchWordProcessor",ni),wi("BrowserBack",Fs),wi("BrowserFavorites",Ps),wi("BrowserForward",Bs),wi("BrowserHome",ks),wi("BrowserRefresh",Ds),wi("BrowserSearch",Cs),wi("BrowserStop",Ls),wi("Dimmer",zs),wi("MediaAudioTrack",ui),wi("RandomToggle",_i),wi("SplitScreenToggle",ii),wi("Subtitle",di),wi("VideoModeNext",mi),vi("=",hs,Te),vi("+",Xt,Me),vi("-",qt,Ie),vi("*",Gt,Ue),vi("/",Zt,He),vi(".",jt,Pe),vi(",",Yt,Re),vi("0",Jt,Ke),vi("1",$t,Ne),vi("2",es,ze),vi("3",ts,Ve),vi("4",ss,Oe),vi("5",is,We),vi("6",ns,Ge),vi("7",rs,Xe),vi("8",os,Ye),vi("9",as,qe);class Qi{constructor(e){this._target=e||null,this._keyDownList={},this._pendingKey=null,this._altGrArmed=!1,this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this),checkalt:this._checkAlt.bind(this)},this.onkeyevent=()=>{}}_sendKeyEvent(e,s,i){if(i)this._keyDownList[s]=e;else{if(!(s in this._keyDownList))return;delete this._keyDownList[s]}t("onkeyevent "+(i?"down":"up")+", keysym: "+e,", code: "+s),this.onkeyevent(e,s,i)}_getKeysym(e){}_getKeyCode(e){const t=yi(e);if("Unidentified"!==t)return t;if(e.keyCode&&"keypress"!==e.type&&229!==e.keyCode)return"Platform"+e.keyCode;if(e.keyIdentifier){if("U+"!==e.keyIdentifier.substr(0,2))return e.keyIdentifier;const t=parseInt(e.keyIdentifier.substr(2),16);return"Platform"+String.fromCharCode(t).toUpperCase().charCodeAt()}return"Unidentified"}_handleKeyDown(e){const t=this._getKeyCode(e);let s=ki(e);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),"AltRight"===t&&e.timeStamp-this._altGrCtrlTime<50?s=Kt:this._sendKeyEvent(Tt,"ControlLeft",!0)),"Unidentified"===t||navigator&&(/ipad/i.exec(navigator.platform)||/iphone/i.exec(navigator.platform)||/ipod/i.exec(navigator.platform)))return s&&(this._sendKeyEvent(s,t,!0),this._sendKeyEvent(s,t,!1)),void m(e);if(h())switch(s){case Pt:s=Rt;break;case Ht:s=Pt;break;case Rt:s=we;break;case It:s=Kt}return t in this._keyDownList&&(s=this._keyDownList[t]),h()&&"CapsLock"===t?(this._sendKeyEvent(Mt,"CapsLock",!0),this._sendKeyEvent(Mt,"CapsLock",!1),void m(e)):s||e.key&&!c()&&!l()?(this._pendingKey=null,m(e),"ControlLeft"===t&&d()&&!("ControlLeft"in this._keyDownList)?(this._altGrArmed=!0,this._altGrTimeout=setTimeout(this._handleAltGrTimeout.bind(this),100),void(this._altGrCtrlTime=e.timeStamp)):void this._sendKeyEvent(s,t,!0)):(this._pendingKey=t,void setTimeout(this._handleKeyPressTimeout.bind(this),10,e))}_handleKeyPress(e){if(m(e),null===this._pendingKey)return;let t=this._getKeyCode(e);const i=ki(e);"Unidentified"!==t&&t!=this._pendingKey||(t=this._pendingKey,this._pendingKey=null,i?this._sendKeyEvent(i,t,!0):s("keypress with no keysym:",e))}_handleKeyPressTimeout(e){if(null===this._pendingKey)return;let t;const s=this._pendingKey;if(this._pendingKey=null,e.keyCode>=48&&e.keyCode<=57)t=e.keyCode;else if(e.keyCode>=65&&e.keyCode<=90){let s=String.fromCharCode(e.keyCode);s=e.shiftKey?s.toUpperCase():s.toLowerCase(),t=s.charCodeAt()}else t=0;this._sendKeyEvent(t,s,!0)}_handleKeyUp(e){m(e);const t=this._getKeyCode(e);if(this._altGrArmed&&(this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Tt,"ControlLeft",!0)),h()&&"CapsLock"===t)return this._sendKeyEvent(Mt,"CapsLock",!0),void this._sendKeyEvent(Mt,"CapsLock",!1);this._sendKeyEvent(this._keyDownList[t],t,!1)}_handleAltGrTimeout(){this._altGrArmed=!1,clearTimeout(this._altGrTimeout),this._sendKeyEvent(Tt,"ControlLeft",!0)}_allKeysUp(){t(">> Keyboard.allKeysUp");for(let e in this._keyDownList)this._sendKeyEvent(this._keyDownList[e],e,!1);t("<< Keyboard.allKeysUp")}_checkAlt(e){if(e.altKey)return;const t=this._target,s=this._keyDownList;["AltLeft","AltRight"].forEach((e=>{if(!(e in s))return;const i=new KeyboardEvent("keyup",{key:s[e],code:e});t.dispatchEvent(i)}))}grab(){if(this._target.addEventListener("keydown",this._eventHandlers.keydown),this._target.addEventListener("keyup",this._eventHandlers.keyup),this._target.addEventListener("keypress",this._eventHandlers.keypress),window.addEventListener("blur",this._eventHandlers.blur),d()&&_()){const e=this._eventHandlers.checkalt;["mousedown","mouseup","mousemove","wheel","touchstart","touchend","touchmove","keydown","keyup"].forEach((t=>document.addEventListener(t,e,{capture:!0,passive:!0})))}}ungrab(){if(d()&&_()){const e=this._eventHandlers.checkalt;["mousedown","mouseup","mousemove","wheel","touchstart","touchend","touchmove","keydown","keyup"].forEach((t=>document.removeEventListener(t,e)))}this._target.removeEventListener("keydown",this._eventHandlers.keydown),this._target.removeEventListener("keyup",this._eventHandlers.keyup),this._target.removeEventListener("keypress",this._eventHandlers.keypress),window.removeEventListener("blur",this._eventHandlers.blur),this._allKeysUp()}}class Ci{constructor(e){this._target=e||document,this._doubleClickTimer=null,this._lastTouchPos=null,this._pos=null,this._wheelStepXTimer=null,this._wheelStepYTimer=null,this._accumulatedWheelDeltaX=0,this._accumulatedWheelDeltaY=0,this._eventHandlers={mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this)},this.touchButton=1,this.onmousebutton=()=>{},this.onmousemove=()=>{}}_resetDoubleClickTimer(){this._doubleClickTimer=null}_handleMouseButton(e,s){this._updateMousePosition(e);let i,n=this._pos;if(e.touches||e.changedTouches){if(1==s){if(null===this._doubleClickTimer)this._lastTouchPos=n;else{clearTimeout(this._doubleClickTimer);const e=this._lastTouchPos.x-n.x,t=this._lastTouchPos.y-n.y;Math.sqrt(e*e+t*t)<20*(window.devicePixelRatio||1)&&(n=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}i=this.touchButton}else i=e.which?1<<e.button:(1&e.button)+2*(2&e.button)+(4&e.button)/2;t("onmousebutton "+(s?"down":"up")+", x: "+n.x+", y: "+n.y+", bmask: "+i),this.onmousebutton(n.x,n.y,s,i),m(e)}_handleMouseDown(e){"mousedown"===e.type&&function(e){if(e.setCapture)e.setCapture(),e.addEventListener("mouseup",Q);else{Q();let t=document.getElementById("noVNC_mouse_capture_elem");null===t&&(t=document.createElement("div"),t.id="noVNC_mouse_capture_elem",t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.width="100%",t.style.height="100%",t.style.zIndex=1e4,t.style.display="none",document.body.appendChild(t),t.addEventListener("contextmenu",b),t.addEventListener("mousemove",b),t.addEventListener("mouseup",b)),w=e,k++,y.observe(e,{attributes:!0}),v(),t.style.display="",window.addEventListener("mousemove",b),window.addEventListener("mouseup",b)}}(this._target),this._handleMouseButton(e,1)}_handleMouseUp(e){this._handleMouseButton(e,0)}_generateWheelStepX(){this._accumulatedWheelDeltaX<0?(this.onmousebutton(this._pos.x,this._pos.y,1,32),this.onmousebutton(this._pos.x,this._pos.y,0,32)):this._accumulatedWheelDeltaX>0&&(this.onmousebutton(this._pos.x,this._pos.y,1,64),this.onmousebutton(this._pos.x,this._pos.y,0,64)),this._accumulatedWheelDeltaX=0}_generateWheelStepY(){this._accumulatedWheelDeltaY<0?(this.onmousebutton(this._pos.x,this._pos.y,1,8),this.onmousebutton(this._pos.x,this._pos.y,0,8)):this._accumulatedWheelDeltaY>0&&(this.onmousebutton(this._pos.x,this._pos.y,1,16),this.onmousebutton(this._pos.x,this._pos.y,0,16)),this._accumulatedWheelDeltaY=0}_resetWheelStepTimers(){window.clearTimeout(this._wheelStepXTimer),window.clearTimeout(this._wheelStepYTimer),this._wheelStepXTimer=null,this._wheelStepYTimer=null}_handleMouseWheel(e){this._resetWheelStepTimers(),this._updateMousePosition(e);let t=e.deltaX,s=e.deltaY;0!==e.deltaMode&&(t*=19,s*=19),this._accumulatedWheelDeltaX+=t,this._accumulatedWheelDeltaY+=s,Math.abs(this._accumulatedWheelDeltaX)>10?this._generateWheelStepX():this._wheelStepXTimer=window.setTimeout(this._generateWheelStepX.bind(this),50),Math.abs(this._accumulatedWheelDeltaY)>10?this._generateWheelStepY():this._wheelStepYTimer=window.setTimeout(this._generateWheelStepY.bind(this),50),m(e)}_handleMouseMove(e){this._updateMousePosition(e),this.onmousemove(this._pos.x,this._pos.y),m(e)}_handleMouseDisable(e){e.target==this._target&&m(e)}_updateMousePosition(e){e=function(e){return e.changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e}(e);const t=this._target.getBoundingClientRect();let s,i;s=e.clientX<t.left?0:e.clientX>=t.right?t.width-1:e.clientX-t.left,i=e.clientY<t.top?0:e.clientY>=t.bottom?t.height-1:e.clientY-t.top,this._pos={x:s,y:i}}grab(){const e=this._target;r&&(e.addEventListener("touchstart",this._eventHandlers.mousedown),e.addEventListener("touchend",this._eventHandlers.mouseup),e.addEventListener("touchmove",this._eventHandlers.mousemove)),e.addEventListener("mousedown",this._eventHandlers.mousedown),e.addEventListener("mouseup",this._eventHandlers.mouseup),e.addEventListener("mousemove",this._eventHandlers.mousemove),e.addEventListener("wheel",this._eventHandlers.mousewheel),document.addEventListener("click",this._eventHandlers.mousedisable),e.addEventListener("contextmenu",this._eventHandlers.mousedisable)}ungrab(){const e=this._target;this._resetWheelStepTimers(),r&&(e.removeEventListener("touchstart",this._eventHandlers.mousedown),e.removeEventListener("touchend",this._eventHandlers.mouseup),e.removeEventListener("touchmove",this._eventHandlers.mousemove)),e.removeEventListener("mousedown",this._eventHandlers.mousedown),e.removeEventListener("mouseup",this._eventHandlers.mouseup),e.removeEventListener("mousemove",this._eventHandlers.mousemove),e.removeEventListener("wheel",this._eventHandlers.mousewheel),document.removeEventListener("click",this._eventHandlers.mousedisable),e.removeEventListener("contextmenu",this._eventHandlers.mousedisable)}}const xi=!function(){if(null===a)try{const e=document.createElement("canvas");e.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',e.style.cursor?(s("Data URI scheme cursor supported"),a=!0):(i("Data URI scheme cursor not supported"),a=!1)}catch(e){n("Data URI scheme cursor test exception: "+e),a=!1}return a}()||r;class Si{constructor(e){this._target=null,this._canvas=document.createElement("canvas"),xi&&(this._canvas.style.position="fixed",this._canvas.style.zIndex="65535",this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",document.body.appendChild(this._canvas)),this._position={x:0,y:0},this._hotSpot={x:0,y:0},this._eventHandlers={mouseover:this._handleMouseOver.bind(this),mouseleave:this._handleMouseLeave.bind(this),mousemove:this._handleMouseMove.bind(this),mouseup:this._handleMouseUp.bind(this),touchstart:this._handleTouchStart.bind(this),touchmove:this._handleTouchMove.bind(this),touchend:this._handleTouchEnd.bind(this)}}attach(e){if(this._target&&this.detach(),this._target=e,xi){const e={capture:!0,passive:!0};this._target.addEventListener("mouseover",this._eventHandlers.mouseover,e),this._target.addEventListener("mouseleave",this._eventHandlers.mouseleave,e),this._target.addEventListener("mousemove",this._eventHandlers.mousemove,e),this._target.addEventListener("mouseup",this._eventHandlers.mouseup,e),window.addEventListener("touchstart",this._eventHandlers.touchstart,e),this._target.addEventListener("touchmove",this._eventHandlers.touchmove,e),this._target.addEventListener("touchend",this._eventHandlers.touchend,e)}this.clear()}detach(){if(xi){const e={capture:!0,passive:!0};this._target.removeEventListener("mouseover",this._eventHandlers.mouseover,e),this._target.removeEventListener("mouseleave",this._eventHandlers.mouseleave,e),this._target.removeEventListener("mousemove",this._eventHandlers.mousemove,e),this._target.removeEventListener("mouseup",this._eventHandlers.mouseup,e),window.removeEventListener("touchstart",this._eventHandlers.touchstart,e),this._target.removeEventListener("touchmove",this._eventHandlers.touchmove,e),this._target.removeEventListener("touchend",this._eventHandlers.touchend,e)}this._target=null}change(e,t,s,i,n){if(0===i||0===n)return void this.clear();this._position.x=this._position.x+this._hotSpot.x-t,this._position.y=this._position.y+this._hotSpot.y-s,this._hotSpot.x=t,this._hotSpot.y=s;let r,o=this._canvas.getContext("2d");this._canvas.width=i,this._canvas.height=n;try{r=new ImageData(new Uint8ClampedArray(e),i,n)}catch(t){r=o.createImageData(i,n),r.data.set(new Uint8ClampedArray(e))}if(o.clearRect(0,0,i,n),o.putImageData(r,0,0),xi)this._updatePosition();else{let e=this._canvas.toDataURL();this._target.style.cursor="url("+e+")"+t+" "+s+", default"}}clear(){this._target.style.cursor="none",this._canvas.width=0,this._canvas.height=0,this._position.x=this._position.x+this._hotSpot.x,this._position.y=this._position.y+this._hotSpot.y,this._hotSpot.x=0,this._hotSpot.y=0}_handleMouseOver(e){this._handleMouseMove(e)}_handleMouseLeave(e){this._hideCursor()}_handleMouseMove(e){this._updateVisibility(e.target),this._position.x=e.clientX-this._hotSpot.x,this._position.y=e.clientY-this._hotSpot.y,this._updatePosition()}_handleMouseUp(e){let t=document.elementFromPoint(e.clientX,e.clientY);this._updateVisibility(t)}_handleTouchStart(e){this._handleTouchMove(e)}_handleTouchMove(e){this._updateVisibility(e.target),this._position.x=e.changedTouches[0].clientX-this._hotSpot.x,this._position.y=e.changedTouches[0].clientY-this._hotSpot.y,this._updatePosition()}_handleTouchEnd(e){let t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY);this._updateVisibility(t)}_showCursor(){"hidden"===this._canvas.style.visibility&&(this._canvas.style.visibility="")}_hideCursor(){"hidden"!==this._canvas.style.visibility&&(this._canvas.style.visibility="hidden")}_shouldShowCursor(e){return e===this._target||!!this._target.contains(e)&&"none"===window.getComputedStyle(e).cursor}_updateVisibility(e){this._shouldShowCursor(e)?this._showCursor():this._hideCursor()}_updatePosition(){this._canvas.style.left=this._position.x+"px",this._canvas.style.top=this._position.y+"px"}}const Ai=41943040;class Ei{constructor(){this._websocket=null,this._rQi=0,this._rQlen=0,this._rQbufferSize=4194304,this._rQmax=this._rQbufferSize/8,this._rQ=null,this._sQbufferSize=10240,this._sQlen=0,this._sQ=null,this._eventHandlers={message:()=>{},open:()=>{},close:()=>{},error:()=>{}}}get_sQ(){return this._sQ}get_rQ(){return this._rQ}get_rQi(){return this._rQi}set_rQi(e){this._rQi=e}rQlen(){return this._rQlen-this._rQi}rQpeek8(){return this._rQ[this._rQi]}rQshift8(){return this._rQ[this._rQi++]}rQskip8(){this._rQi++}rQskipBytes(e){this._rQi+=e}rQshift16(){return(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]}rQshift32(){return(this._rQ[this._rQi++]<<24)+(this._rQ[this._rQi++]<<16)+(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]}rQshiftStr(e){void 0===e&&(e=this.rQlen());let t="";for(let s=0;s<e;s+=4096){let i=this.rQshiftBytes(Math.min(4096,e-s));t+=String.fromCharCode.apply(null,i)}return t}rQshiftBytes(e){return void 0===e&&(e=this.rQlen()),this._rQi+=e,new Uint8Array(this._rQ.buffer,this._rQi-e,e)}rQshiftTo(e,t){void 0===t&&(t=this.rQlen()),e.set(new Uint8Array(this._rQ.buffer,this._rQi,t)),this._rQi+=t}rQwhole(){return new Uint8Array(this._rQ.buffer,0,this._rQlen)}rQslice(e,t){return t?new Uint8Array(this._rQ.buffer,this._rQi+e,t-e):new Uint8Array(this._rQ.buffer,this._rQi+e,this._rQlen-this._rQi-e)}rQwait(e,t,s){if(this._rQlen-this._rQi<t){if(s){if(this._rQi<s)throw new Error("rQwait cannot backup "+s+" bytes");this._rQi-=s}return!0}return!1}flush(){this._sQlen>0&&this._websocket.readyState===WebSocket.OPEN&&(this._websocket.send(this._encode_message()),this._sQlen=0)}send(e){this._sQ.set(e,this._sQlen),this._sQlen+=e.length,this.flush()}send_string(e){this.send(e.split("").map((e=>e.charCodeAt(0))))}off(e){this._eventHandlers[e]=()=>{}}on(e,t){this._eventHandlers[e]=t}_allocate_buffers(){this._rQ=new Uint8Array(this._rQbufferSize),this._sQ=new Uint8Array(this._sQbufferSize)}init(){this._allocate_buffers(),this._rQi=0,this._websocket=null}open(e,i){this.init(),this._websocket=new WebSocket(e,i),this._websocket.binaryType="arraybuffer",this._websocket.onmessage=this._recv_message.bind(this),this._websocket.onopen=()=>{t(">> WebSock.onopen"),this._websocket.protocol&&s("Server choose sub-protocol: "+this._websocket.protocol),this._eventHandlers.open(),t("<< WebSock.onopen")},this._websocket.onclose=e=>{t(">> WebSock.onclose"),this._eventHandlers.close(e),t("<< WebSock.onclose")},this._websocket.onerror=e=>{t(">> WebSock.onerror: "+e),this._eventHandlers.error(e),t("<< WebSock.onerror: "+e)}}close(){this._websocket&&(this._websocket.readyState!==WebSocket.OPEN&&this._websocket.readyState!==WebSocket.CONNECTING||(s("Closing WebSocket connection"),this._websocket.close()),this._websocket.onmessage=()=>{})}_encode_message(){return new Uint8Array(this._sQ.buffer,0,this._sQlen)}_expand_compact_rQ(e){const t=e||this._rQlen-this._rQi>this._rQbufferSize/2;if(t&&(e?this._rQbufferSize=8*(this._rQlen-this._rQi+e):this._rQbufferSize*=2),this._rQbufferSize>Ai&&(this._rQbufferSize=Ai,this._rQbufferSize-this._rQlen-this._rQi<e))throw new Error("Receive Queue buffer exceeded 41943040 bytes, and the new message could not fit");if(t){const e=this._rQ.buffer;this._rQmax=this._rQbufferSize/8,this._rQ=new Uint8Array(this._rQbufferSize),this._rQ.set(new Uint8Array(e,this._rQi))}else this._rQ.set(new Uint8Array(this._rQ.buffer,this._rQi));this._rQlen=this._rQlen-this._rQi,this._rQi=0}_decode_message(e){const t=new Uint8Array(e);t.length>this._rQbufferSize-this._rQlen&&this._expand_compact_rQ(t.length),this._rQ.set(t,this._rQlen),this._rQlen+=t.length}_recv_message(e){this._decode_message(e.data),this.rQlen()>0?(this._eventHandlers.message(),this._rQlen==this._rQi?(this._rQlen=0,this._rQi=0):this._rQlen>this._rQmax&&this._expand_compact_rQ()):t("Ignoring empty message")}}function Fi(e){const t=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],s=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],i=[];let n,r,o,a,h,c;n=65536,r=1<<24,o=n|r,a=4,h=1024,c=a|h;const l=[o|h,0,0|n,o|c,o|a,n|c,0|a,0|n,0|h,o|h,o|c,0|h,r|c,o|a,0|r,0|a,0|c,r|h,r|h,n|h,n|h,0|o,0|o,r|c,n|a,r|a,r|a,n|a,0,0|c,n|c,0|r,0|n,o|c,0|a,0|o,o|h,0|r,0|r,0|h,o|a,0|n,n|h,r|a,0|h,0|a,r|c,n|c,o|c,n|a,0|o,r|c,r|a,0|c,n|c,o|h,0|c,r|h,r|h,0,n|a,n|h,0,o|a];n=1<<20,r=1<<31,o=n|r,a=32,h=32768,c=a|h;const _=[o|c,r|h,0|h,n|c,0|n,0|a,o|a,r|c,r|a,o|c,o|h,0|r,r|h,0|n,0|a,o|a,n|h,n|a,r|c,0,0|r,0|h,n|c,0|o,n|a,r|a,0,n|h,0|c,o|h,0|o,0|c,0,n|c,o|a,0|n,r|c,0|o,o|h,0|h,0|o,r|h,0|a,o|c,n|c,0|a,0|h,0|r,0|c,o|h,0|n,r|a,n|a,r|c,r|a,n|a,n|h,0,r|h,0|c,0|r,o|a,o|c,n|h];n=1<<17,r=1<<27,o=n|r,a=8,h=512,c=a|h;const d=[0|c,o|h,0,o|a,r|h,0,n|c,r|h,n|a,r|a,r|a,0|n,o|c,n|a,0|o,0|c,0|r,0|a,o|h,0|h,n|h,0|o,o|a,n|c,r|c,n|h,0|n,r|c,0|a,o|c,0|h,0|r,o|h,0|r,n|a,0|c,0|n,o|h,r|h,0,0|h,n|a,o|c,r|h,r|a,0|h,0,o|a,r|c,0|n,0|r,o|c,0|a,n|c,n|h,r|a,0|o,r|c,0|c,0|o,n|c,0|a,o|a,n|h];n=8192,r=1<<23,o=n|r,a=1,h=128,c=a|h;const u=[o|a,n|c,n|c,0|h,o|h,r|c,r|a,n|a,0,0|o,0|o,o|c,0|c,0,r|h,r|a,0|a,0|n,0|r,o|a,0|h,0|r,n|a,n|h,r|c,0|a,n|h,r|h,0|n,o|h,o|c,0|c,r|h,r|a,0|o,o|c,0|c,0,0,0|o,n|h,r|h,r|c,0|a,o|a,n|c,n|c,0|h,o|c,0|c,0|a,0|n,r|a,n|a,o|h,r|c,n|a,n|h,0|r,o|a,0|h,0|r,0|n,o|h];n=1<<25,r=1<<30,o=n|r,a=256,h=1<<19,c=a|h;const f=[0|a,n|c,n|h,o|a,0|h,0|a,0|r,n|h,r|c,0|h,n|a,r|c,o|a,o|h,0|c,0|r,0|n,r|h,r|h,0,r|a,o|c,o|c,n|a,o|h,r|a,0,0|o,n|c,0|n,0|o,0|c,0|h,o|a,0|a,0|n,0|r,n|h,o|a,r|c,n|a,0|r,o|h,n|c,r|c,0|a,0|n,o|h,o|c,0|c,0|o,o|c,n|h,0,r|h,0|o,0|c,n|a,r|a,0|h,0,r|h,n|c,r|a];n=1<<22,r=1<<29,o=n|r,a=16,h=16384,c=a|h;const p=[r|a,0|o,0|h,o|c,0|o,0|a,o|c,0|n,r|h,n|c,0|n,r|a,n|a,r|h,0|r,0|c,0,n|a,r|c,0|h,n|h,r|c,0|a,o|a,o|a,0,n|c,o|h,0|c,n|h,o|h,0|r,r|h,0|a,o|a,n|h,o|c,0|n,0|c,r|a,0|n,r|h,0|r,0|c,r|a,o|c,n|h,0|o,n|c,o|h,0,o|a,0|a,0|h,0|o,n|c,0|h,n|a,r|c,0,o|h,0|r,n|a,r|c];n=1<<21,r=1<<26,o=n|r,a=2,h=2048,c=a|h;const m=[0|n,o|a,r|c,0,0|h,r|c,n|c,o|h,o|c,0|n,0,r|a,0|a,0|r,o|a,0|c,r|h,n|c,n|a,r|h,r|a,0|o,o|h,n|a,0|o,0|h,0|c,o|c,n|h,0|a,0|r,n|h,0|r,n|h,0|n,r|c,r|c,o|a,o|a,0|a,n|a,0|r,r|h,0|n,o|h,0|c,n|c,o|h,0|c,r|a,o|c,0|o,n|h,0,0|a,o|c,0,n|c,0|o,0|h,r|a,r|h,0|h,n|a];n=1<<18,r=1<<28,o=n|r,a=64,h=4096,c=a|h;const g=[r|c,0|h,0|n,o|c,0|r,r|c,0|a,0|r,n|a,0|o,o|c,n|h,o|h,n|c,0|h,0|a,0|o,r|a,r|h,0|c,n|h,n|a,o|a,o|h,0|c,0,0,o|a,r|a,r|h,n|c,0|n,n|c,0|n,o|h,0|h,0|a,o|a,0|h,n|c,r|h,0|a,r|a,0|o,o|a,0|r,0|n,r|c,0,o|c,n|a,r|a,0|o,r|h,r|c,0,o|c,n|h,n|h,0|c,0|c,n|a,0|r,o|h];function w(e){const t=e.slice();let s,n,r,o=0;s=t[o++]<<24|t[o++]<<16|t[o++]<<8|t[o++],n=t[o++]<<24|t[o++]<<16|t[o++]<<8|t[o++],r=252645135&(s>>>4^n),n^=r,s^=r<<4,r=65535&(s>>>16^n),n^=r,s^=r<<16,r=858993459&(n>>>2^s),s^=r,n^=r<<2,r=16711935&(n>>>8^s),s^=r,n^=r<<8,n=n<<1|n>>>31&1,r=2863311530&(s^n),s^=r,n^=r,s=s<<1|s>>>31&1;for(let e=0,t=0;e<8;++e){r=n<<28|n>>>4,r^=i[t++];let e=m[63&r];e|=f[r>>>8&63],e|=d[r>>>16&63],e|=l[r>>>24&63],r=n^i[t++],e|=g[63&r],e|=p[r>>>8&63],e|=u[r>>>16&63],e|=_[r>>>24&63],s^=e,r=s<<28|s>>>4,r^=i[t++],e=m[63&r],e|=f[r>>>8&63],e|=d[r>>>16&63],e|=l[r>>>24&63],r=s^i[t++],e|=g[63&r],e|=p[r>>>8&63],e|=u[r>>>16&63],e|=_[r>>>24&63],n^=e}for(n=n<<31|n>>>1,r=2863311530&(s^n),s^=r,n^=r,s=s<<31|s>>>1,r=16711935&(s>>>8^n),n^=r,s^=r<<8,r=858993459&(s>>>2^n),n^=r,s^=r<<2,r=65535&(n>>>16^s),s^=r,n^=r<<16,r=252645135&(n>>>4^s),s^=r,n^=r<<4,r=[n,s],o=0;o<8;o++)t[o]=(r[o>>>2]>>>8*(3-o%4))%256,t[o]<0&&(t[o]+=256);return t}return function(e){const n=[],r=[],o=[];for(let t=0,s=56;t<56;++t,s-=8){s+=s<-5?65:s<-3?31:s<-1?63:27===s?35:0;const i=7&s;n[t]=0!=(e[s>>>3]&1<<i)?1:0}for(let e=0;e<16;++e){const i=e<<1,a=i+1;o[i]=o[a]=0;for(let t=28;t<59;t+=28)for(let i=t-28;i<t;++i){const o=i+s[e];r[i]=o<t?n[o]:n[o-28]}for(let e=0;e<24;++e)0!==r[t[e]]&&(o[i]|=1<<23-e),0!==r[t[e+24]]&&(o[a]|=1<<23-e)}for(let e=0,t=0,s=0;e<16;++e){const e=o[t++],n=o[t++];i[s]=(16515072&e)<<6,i[s]|=(4032&e)<<10,i[s]|=(16515072&n)>>>10,i[s]|=(4032&n)>>>6,++s,i[s]=(258048&e)<<12,i[s]|=(63&e)<<16,i[s]|=(258048&n)>>>4,i[s]|=63&n,++s}}(e),{encrypt:function(e){return w(e.slice(0,8)).concat(w(e.slice(8,16)))}}}var Bi={Again:57349,AltLeft:56,AltRight:57400,ArrowDown:57424,ArrowLeft:57419,ArrowRight:57421,ArrowUp:57416,AudioVolumeDown:57390,AudioVolumeMute:57376,AudioVolumeUp:57392,Backquote:41,Backslash:43,Backspace:14,BracketLeft:26,BracketRight:27,BrowserBack:57450,BrowserFavorites:57446,BrowserForward:57449,BrowserHome:57394,BrowserRefresh:57447,BrowserSearch:57445,BrowserStop:57448,CapsLock:58,Comma:51,ContextMenu:57437,ControlLeft:29,ControlRight:57373,Convert:121,Copy:57464,Cut:57404,Delete:57427,Digit0:11,Digit1:2,Digit2:3,Digit3:4,Digit4:5,Digit5:6,Digit6:7,Digit7:8,Digit8:9,Digit9:10,Eject:57469,End:57423,Enter:28,Equal:13,Escape:1,F1:59,F10:68,F11:87,F12:88,F13:93,F14:94,F15:95,F16:85,F17:57347,F18:57463,F19:57348,F2:60,F20:90,F21:116,F22:57465,F23:109,F24:111,F3:61,F4:62,F5:63,F6:64,F7:65,F8:66,F9:67,Find:57409,Help:57461,Hiragana:119,Home:57415,Insert:57426,IntlBackslash:86,IntlRo:115,IntlYen:125,KanaMode:112,Katakana:120,KeyA:30,KeyB:48,KeyC:46,KeyD:32,KeyE:18,KeyF:33,KeyG:34,KeyH:35,KeyI:23,KeyJ:36,KeyK:37,KeyL:38,KeyM:50,KeyN:49,KeyO:24,KeyP:25,KeyQ:16,KeyR:19,KeyS:31,KeyT:20,KeyU:22,KeyV:47,KeyW:17,KeyX:45,KeyY:21,KeyZ:44,Lang3:120,Lang4:119,Lang5:118,LaunchApp1:57451,LaunchApp2:57377,LaunchMail:57452,MediaPlayPause:57378,MediaSelect:57453,MediaStop:57380,MediaTrackNext:57369,MediaTrackPrevious:57360,MetaLeft:57435,MetaRight:57436,Minus:12,NonConvert:123,NumLock:69,Numpad0:82,Numpad1:79,Numpad2:80,Numpad3:81,Numpad4:75,Numpad5:76,Numpad6:77,Numpad7:71,Numpad8:72,Numpad9:73,NumpadAdd:78,NumpadComma:126,NumpadDecimal:83,NumpadDivide:57397,NumpadEnter:57372,NumpadEqual:89,NumpadMultiply:55,NumpadParenLeft:57462,NumpadParenRight:57467,NumpadSubtract:74,Open:100,PageDown:57425,PageUp:57417,Paste:101,Pause:57414,Period:52,Power:57438,PrintScreen:84,Props:57350,Quote:40,ScrollLock:70,Semicolon:39,ShiftLeft:42,ShiftRight:54,Slash:53,Sleep:57439,Space:57,Suspend:57381,Tab:15,Undo:57351,WakeUp:57443};const Li=0,Di=1,Ti=2,Ui=5,Mi=7,Ri=-260,Ii=-32,Pi=-223,Hi=-224,Ki=-239,Ni=-258,zi=-308,Vi=-309,Oi=-312,Wi=-313,Gi=-256;"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");const s=Object(e);for(let e=1;e<arguments.length;e++){const t=arguments[e];if(null!=t)for(let e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s[e]=t[e])}return s},writable:!0,configurable:!0}),(()=>{function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};const s=document.createEvent("CustomEvent");return s.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),s}e.prototype=window.Event.prototype,"function"!=typeof window.CustomEvent&&(window.CustomEvent=e)})();class Xi{constructor(){this._lines=0}decodeRect(e,t,s,i,n,r,o){0===this._lines&&(this._lines=i);const a=s*(8==o?1:4);if(n.rQwait("RAW",a))return!1;const h=t+(i-this._lines),c=Math.min(this._lines,Math.floor(n.rQlen()/a));let l=n.get_rQ(),_=n.get_rQi();if(8==o){const e=s*c,t=new Uint8Array(4*e);for(let s=0;s<e;s++)t[4*s+0]=255*(l[_+s]>>0&3)/3,t[4*s+1]=255*(l[_+s]>>2&3)/3,t[4*s+2]=255*(l[_+s]>>4&3)/3,t[4*s+4]=0;l=t,_=0}return r.blitImage(e,h,s,c,l,_),n.rQskipBytes(c*a),this._lines-=c,!(this._lines>0)}}class Yi{decodeRect(e,t,s,i,n,r,o){if(n.rQwait("COPYRECT",4))return!1;let a=n.rQshift16(),h=n.rQshift16();return r.copyImage(a,h,e,t,s,i),!0}}class qi{constructor(){this._subrects=0}decodeRect(e,t,s,i,n,r,o){if(0===this._subrects){if(n.rQwait("RRE",8))return!1;this._subrects=n.rQshift32();let o=n.rQshiftBytes(4);r.fillRect(e,t,s,i,o)}for(;this._subrects>0;){if(n.rQwait("RRE",12))return!1;let s=n.rQshiftBytes(4),i=n.rQshift16(),o=n.rQshift16(),a=n.rQshift16(),h=n.rQshift16();r.fillRect(e+i,t+o,a,h,s),this._subrects--}return!0}}class ji{constructor(){this._tiles=0,this._lastsubencoding=0}decodeRect(e,s,i,n,r,o,a){for(0===this._tiles&&(this._tiles_x=Math.ceil(i/16),this._tiles_y=Math.ceil(n/16),this._total_tiles=this._tiles_x*this._tiles_y,this._tiles=this._total_tiles);this._tiles>0;){let a=1;if(r.rQwait("HEXTILE",a))return!1;let h=r.get_rQ(),c=r.get_rQi(),l=h[c];if(l>30)throw Error("Illegal hextile subencoding (subencoding: "+l+")");const _=this._total_tiles-this._tiles,d=e+16*(_%this._tiles_x),u=s+16*Math.floor(_/this._tiles_x),f=Math.min(16,e+i-d),p=Math.min(16,s+n-u);if(1&l)a+=f*p*4;else if(2&l&&(a+=4),4&l&&(a+=4),8&l){if(a++,r.rQwait("HEXTILE",a))return!1;let e=h[c+a-1];a+=16&l?6*e:2*e}if(r.rQwait("HEXTILE",a))return!1;if(c++,0===l)1&this._lastsubencoding?t("     Ignoring blank after RAW"):o.fillRect(d,u,f,p,this._background);else if(1&l)o.blitImage(d,u,f,p,h,c),c+=a-1;else{if(2&l&&(this._background=[h[c],h[c+1],h[c+2],h[c+3]],c+=4),4&l&&(this._foreground=[h[c],h[c+1],h[c+2],h[c+3]],c+=4),o.startTile(d,u,f,p,this._background),8&l){let e=h[c];c++;for(let t=0;t<e;t++){let e;16&l?(e=[h[c],h[c+1],h[c+2],h[c+3]],c+=4):e=this._foreground;const t=h[c];c++;const s=t>>4,i=15&t,n=h[c];c++;const r=1+(n>>4),a=1+(15&n);o.subTile(s,i,r,a,e)}}o.finishTile()}r.set_rQi(c),this._lastsubencoding=l,this._tiles--}return!0}}function Zi(e,t,s,i,n){if(t.subarray&&e.subarray)e.set(t.subarray(s,s+i),n);else for(var r=0;r<i;r++)e[n+r]=t[s+r]}var Ji=Uint8Array,$i=Uint16Array,en=Int32Array;function tn(e,t,s,i){for(var n=65535&e|0,r=e>>>16&65535|0,o=0;0!==s;){s-=o=s>2e3?2e3:s;do{r=r+(n=n+t[i++]|0)|0}while(--o);n%=65521,r%=65521}return n|r<<16|0}function sn(){for(var e,t=[],s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t}sn();function nn(e,t){var s,i,n,r,o,a,h,c,l,_,d,u,f,p,m,g,w,b,v,y,k,Q,C,x,S;s=e.state,i=e.next_in,x=e.input,n=i+(e.avail_in-5),r=e.next_out,S=e.output,o=r-(t-e.avail_out),a=r+(e.avail_out-257),h=s.dmax,c=s.wsize,l=s.whave,_=s.wnext,d=s.window,u=s.hold,f=s.bits,p=s.lencode,m=s.distcode,g=(1<<s.lenbits)-1,w=(1<<s.distbits)-1;e:do{f<15&&(u+=x[i++]<<f,f+=8,u+=x[i++]<<f,f+=8),b=p[u&g];t:for(;;){if(u>>>=v=b>>>24,f-=v,0===(v=b>>>16&255))S[r++]=65535&b;else{if(!(16&v)){if(0==(64&v)){b=p[(65535&b)+(u&(1<<v)-1)];continue t}if(32&v){s.mode=12;break e}e.msg="invalid literal/length code",s.mode=30;break e}y=65535&b,(v&=15)&&(f<v&&(u+=x[i++]<<f,f+=8),y+=u&(1<<v)-1,u>>>=v,f-=v),f<15&&(u+=x[i++]<<f,f+=8,u+=x[i++]<<f,f+=8),b=m[u&w];s:for(;;){if(u>>>=v=b>>>24,f-=v,!(16&(v=b>>>16&255))){if(0==(64&v)){b=m[(65535&b)+(u&(1<<v)-1)];continue s}e.msg="invalid distance code",s.mode=30;break e}if(k=65535&b,f<(v&=15)&&(u+=x[i++]<<f,(f+=8)<v&&(u+=x[i++]<<f,f+=8)),(k+=u&(1<<v)-1)>h){e.msg="invalid distance too far back",s.mode=30;break e}if(u>>>=v,f-=v,k>(v=r-o)){if((v=k-v)>l&&s.sane){e.msg="invalid distance too far back",s.mode=30;break e}if(Q=0,C=d,0===_){if(Q+=c-v,v<y){y-=v;do{S[r++]=d[Q++]}while(--v);Q=r-k,C=S}}else if(_<v){if(Q+=c+_-v,(v-=_)<y){y-=v;do{S[r++]=d[Q++]}while(--v);if(Q=0,_<y){y-=v=_;do{S[r++]=d[Q++]}while(--v);Q=r-k,C=S}}}else if(Q+=_-v,v<y){y-=v;do{S[r++]=d[Q++]}while(--v);Q=r-k,C=S}for(;y>2;)S[r++]=C[Q++],S[r++]=C[Q++],S[r++]=C[Q++],y-=3;y&&(S[r++]=C[Q++],y>1&&(S[r++]=C[Q++]))}else{Q=r-k;do{S[r++]=S[Q++],S[r++]=S[Q++],S[r++]=S[Q++],y-=3}while(y>2);y&&(S[r++]=S[Q++],y>1&&(S[r++]=S[Q++]))}break}}break}}while(i<n&&r<a);i-=y=f>>3,u&=(1<<(f-=y<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=r<a?a-r+257:257-(r-a),s.hold=u,s.bits=f}var rn=15,on=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],an=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],hn=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],cn=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function ln(e,t,s,i,n,r,o,a){var h,c,l,_,d,u,f,p,m,g=a.bits,w=0,b=0,v=0,y=0,k=0,Q=0,C=0,x=0,S=0,A=0,E=null,F=0,B=new $i(16),L=new $i(16),D=null,T=0;for(w=0;w<=rn;w++)B[w]=0;for(b=0;b<i;b++)B[t[s+b]]++;for(k=g,y=rn;y>=1&&0===B[y];y--);if(k>y&&(k=y),0===y)return n[r++]=20971520,n[r++]=20971520,a.bits=1,0;for(v=1;v<y&&0===B[v];v++);for(k<v&&(k=v),x=1,w=1;w<=rn;w++)if(x<<=1,(x-=B[w])<0)return-1;if(x>0&&(0===e||1!==y))return-1;for(L[1]=0,w=1;w<rn;w++)L[w+1]=L[w]+B[w];for(b=0;b<i;b++)0!==t[s+b]&&(o[L[t[s+b]]++]=b);if(0===e?(E=D=o,u=19):1===e?(E=on,F-=257,D=an,T-=257,u=256):(E=hn,D=cn,u=-1),A=0,b=0,w=v,d=r,Q=k,C=0,l=-1,_=(S=1<<k)-1,1===e&&S>852||2===e&&S>592)return 1;for(;;){f=w-C,o[b]<u?(p=0,m=o[b]):o[b]>u?(p=D[T+o[b]],m=E[F+o[b]]):(p=96,m=0),h=1<<w-C,v=c=1<<Q;do{n[d+(A>>C)+(c-=h)]=f<<24|p<<16|m|0}while(0!==c);for(h=1<<w-1;A&h;)h>>=1;if(0!==h?(A&=h-1,A+=h):A=0,b++,0==--B[w]){if(w===y)break;w=t[s+o[b]]}if(w>k&&(A&_)!==l){for(0===C&&(C=k),d+=v,x=1<<(Q=w-C);Q+C<y&&!((x-=B[Q+C])<=0);)Q++,x<<=1;if(S+=1<<Q,1===e&&S>852||2===e&&S>592)return 1;n[l=A&_]=k<<24|Q<<16|d-r|0}}return 0!==A&&(n[d+A]=w-C<<24|64<<16|0),a.bits=k,0}var _n=-2,dn=12,un=30;function fn(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function pn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new $i(320),this.work=new $i(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mn(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,function(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new en(852),t.distcode=t.distdyn=new en(592),t.sane=1,t.back=-1,0):_n}(e)):_n}function gn(e,t){var s,i;return e?(i=new pn,e.state=i,i.window=null,0!==(s=function(e,t){var s,i;return e&&e.state?(i=e.state,t<0?(s=0,t=-t):(s=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_n:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,mn(e))):_n}(e,t))&&(e.state=null),s):_n}var wn,bn,vn=!0;function yn(e){if(vn){var t;for(wn=new en(512),bn=new en(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ln(1,e.lens,0,288,wn,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ln(2,e.lens,0,32,bn,0,e.work,{bits:5}),vn=!1}e.lencode=wn,e.lenbits=9,e.distcode=bn,e.distbits=5}function kn(e,t){var s,i,n,r,o,a,h,c,l,_,d,u,f,p,m,g,w,b,v,y,k,Q,C,x,S=0,A=new Ji(4),E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _n;(s=e.state).mode===dn&&(s.mode=13),o=e.next_out,n=e.output,h=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=s.hold,l=s.bits,_=a,d=h,Q=0;e:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;l<16;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(2&s.wrap&&35615===c){s.check=0,A[0]=255&c,A[1]=c>>>8&255,s.check=sn(s.check),c=0,l=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=un;break}if(8!=(15&c)){e.msg="unknown compression method",s.mode=un;break}if(l-=4,k=8+(15&(c>>>=4)),0===s.wbits)s.wbits=k;else if(k>s.wbits){e.msg="invalid window size",s.mode=un;break}s.dmax=1<<k,e.adler=s.check=1,s.mode=512&c?10:dn,c=0,l=0;break;case 2:for(;l<16;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(s.flags=c,8!=(255&s.flags)){e.msg="unknown compression method",s.mode=un;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=un;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&(A[0]=255&c,A[1]=c>>>8&255,s.check=sn(s.check)),c=0,l=0,s.mode=3;case 3:for(;l<32;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.head&&(s.head.time=c),512&s.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,s.check=sn(s.check)),c=0,l=0,s.mode=4;case 4:for(;l<16;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&(A[0]=255&c,A[1]=c>>>8&255,s.check=sn(s.check)),c=0,l=0,s.mode=5;case 5:if(1024&s.flags){for(;l<16;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&(A[0]=255&c,A[1]=c>>>8&255,s.check=sn(s.check)),c=0,l=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&((u=s.length)>a&&(u=a),u&&(s.head&&(k=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),Zi(s.head.extra,i,r,u,k)),512&s.flags&&(s.check=sn(s.check)),a-=u,r+=u,s.length-=u),s.length))break e;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===a)break e;u=0;do{k=i[r+u++],s.head&&k&&s.length<65536&&(s.head.name+=String.fromCharCode(k))}while(k&&u<a);if(512&s.flags&&(s.check=sn(s.check)),a-=u,r+=u,k)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===a)break e;u=0;do{k=i[r+u++],s.head&&k&&s.length<65536&&(s.head.comment+=String.fromCharCode(k))}while(k&&u<a);if(512&s.flags&&(s.check=sn(s.check)),a-=u,r+=u,k)break e}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;l<16;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=un;break}c=0,l=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=dn;break;case 10:for(;l<32;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}e.adler=s.check=fn(c),c=0,l=0,s.mode=11;case 11:if(0===s.havedict)return e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=l,2;e.adler=s.check=1,s.mode=dn;case dn:if(5===t||6===t)break e;case 13:if(s.last){c>>>=7&l,l-=7&l,s.mode=27;break}for(;l<3;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}switch(s.last=1&c,l-=1,3&(c>>>=1)){case 0:s.mode=14;break;case 1:if(yn(s),s.mode=20,6===t){c>>>=2,l-=2;break e}break;case 2:s.mode=17;break;case 3:e.msg="invalid block type",s.mode=un}c>>>=2,l-=2;break;case 14:for(c>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=un;break}if(s.length=65535&c,c=0,l=0,s.mode=15,6===t)break e;case 15:s.mode=16;case 16:if(u=s.length){if(u>a&&(u=a),u>h&&(u=h),0===u)break e;Zi(n,i,r,u,o),a-=u,r+=u,h-=u,o+=u,s.length-=u;break}s.mode=dn;break;case 17:for(;l<14;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(s.nlen=257+(31&c),c>>>=5,l-=5,s.ndist=1+(31&c),c>>>=5,l-=5,s.ncode=4+(15&c),c>>>=4,l-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=un;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;l<3;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.lens[E[s.have++]]=7&c,c>>>=3,l-=3}for(;s.have<19;)s.lens[E[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,C={bits:s.lenbits},Q=ln(0,s.lens,0,19,s.lencode,0,s.work,C),s.lenbits=C.bits,Q){e.msg="invalid code lengths set",s.mode=un;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;g=(S=s.lencode[c&(1<<s.lenbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=l);){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(w<16)c>>>=m,l-=m,s.lens[s.have++]=w;else{if(16===w){for(x=m+2;l<x;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(c>>>=m,l-=m,0===s.have){e.msg="invalid bit length repeat",s.mode=un;break}k=s.lens[s.have-1],u=3+(3&c),c>>>=2,l-=2}else if(17===w){for(x=m+3;l<x;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}l-=m,k=0,u=3+(7&(c>>>=m)),c>>>=3,l-=3}else{for(x=m+7;l<x;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}l-=m,k=0,u=11+(127&(c>>>=m)),c>>>=7,l-=7}if(s.have+u>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=un;break}for(;u--;)s.lens[s.have++]=k}}if(s.mode===un)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=un;break}if(s.lenbits=9,C={bits:s.lenbits},Q=ln(1,s.lens,0,s.nlen,s.lencode,0,s.work,C),s.lenbits=C.bits,Q){e.msg="invalid literal/lengths set",s.mode=un;break}if(s.distbits=6,s.distcode=s.distdyn,C={bits:s.distbits},Q=ln(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,C),s.distbits=C.bits,Q){e.msg="invalid distances set",s.mode=un;break}if(s.mode=20,6===t)break e;case 20:s.mode=21;case 21:if(a>=6&&h>=258){e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=l,nn(e,d),o=e.next_out,n=e.output,h=e.avail_out,r=e.next_in,i=e.input,a=e.avail_in,c=s.hold,l=s.bits,s.mode===dn&&(s.back=-1);break}for(s.back=0;g=(S=s.lencode[c&(1<<s.lenbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=l);){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(g&&0==(240&g)){for(b=m,v=g,y=w;g=(S=s.lencode[y+((c&(1<<b+v)-1)>>b)])>>>16&255,w=65535&S,!(b+(m=S>>>24)<=l);){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}c>>>=b,l-=b,s.back+=b}if(c>>>=m,l-=m,s.back+=m,s.length=w,0===g){s.mode=26;break}if(32&g){s.back=-1,s.mode=dn;break}if(64&g){e.msg="invalid literal/length code",s.mode=un;break}s.extra=15&g,s.mode=22;case 22:if(s.extra){for(x=s.extra;l<x;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,l-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;g=(S=s.distcode[c&(1<<s.distbits)-1])>>>16&255,w=65535&S,!((m=S>>>24)<=l);){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(0==(240&g)){for(b=m,v=g,y=w;g=(S=s.distcode[y+((c&(1<<b+v)-1)>>b)])>>>16&255,w=65535&S,!(b+(m=S>>>24)<=l);){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}c>>>=b,l-=b,s.back+=b}if(c>>>=m,l-=m,s.back+=m,64&g){e.msg="invalid distance code",s.mode=un;break}s.offset=w,s.extra=15&g,s.mode=24;case 24:if(s.extra){for(x=s.extra;l<x;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,l-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=un;break}s.mode=25;case 25:if(0===h)break e;if(u=d-h,s.offset>u){if((u=s.offset-u)>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=un;break}u>s.wnext?(u-=s.wnext,f=s.wsize-u):f=s.wnext-u,u>s.length&&(u=s.length),p=s.window}else p=n,f=o-s.offset,u=s.length;u>h&&(u=h),h-=u,s.length-=u;do{n[o++]=p[f++]}while(--u);0===s.length&&(s.mode=21);break;case 26:if(0===h)break e;n[o++]=s.length,h--,s.mode=21;break;case 27:if(s.wrap){for(;l<32;){if(0===a)break e;a--,c|=i[r++]<<l,l+=8}if(d-=h,e.total_out+=d,s.total+=d,d&&(e.adler=s.check=s.flags?sn(s.check):tn(s.check,n,d,o-d)),d=h,(s.flags?c:fn(c))!==s.check){e.msg="incorrect data check",s.mode=un;break}c=0,l=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;l<32;){if(0===a)break e;a--,c+=i[r++]<<l,l+=8}if(c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=un;break}c=0,l=0}s.mode=29;case 29:Q=1;break e;case un:Q=-3;break e;case 31:return-4;case 32:default:return _n}return e.next_out=o,e.avail_out=h,e.next_in=r,e.avail_in=a,s.hold=c,s.bits=l,(s.wsize||d!==e.avail_out&&s.mode<un&&(s.mode<27||4!==t))&&function(e,t,s,i){var n,r=e.state;null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Ji(r.wsize)),i>=r.wsize?(Zi(r.window,t,s-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):((n=r.wsize-r.wnext)>i&&(n=i),Zi(r.window,t,s-i,n,r.wnext),(i-=n)?(Zi(r.window,t,s-i,i,0),r.wnext=i,r.whave=r.wsize):(r.wnext+=n,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=n)))}(e,e.output,e.next_out,d-e.avail_out),_-=e.avail_in,d-=e.avail_out,e.total_in+=_,e.total_out+=d,s.total+=d,s.wrap&&d&&(e.adler=s.check=s.flags?sn(s.check,e.next_out):tn(s.check,n,d,e.next_out-d)),e.data_type=s.bits+(s.last?64:0)+(s.mode===dn?128:0)+(20===s.mode||15===s.mode?256:0),(0===_&&0===d||4===t)&&0===Q&&(Q=-5),Q}function Qn(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}class Cn{constructor(){var e;this.strm=new Qn,this.chunkSize=102400,this.strm.output=new Uint8Array(this.chunkSize),this.windowBits=5,e=this.strm,this.windowBits,gn(e,15)}inflate(e,t,s){return this.strm.input=e,this.strm.avail_in=this.strm.input.length,this.strm.next_in=0,this.strm.next_out=0,s>this.chunkSize&&(this.chunkSize=s,this.strm.output=new Uint8Array(this.chunkSize)),this.strm.avail_out=this.chunkSize,kn(this.strm,t),new Uint8Array(this.strm.output.buffer,0,this.strm.next_out)}reset(){mn(this.strm)}}class xn{constructor(){this._ctl=null,this._filter=null,this._numColors=0,this._palette=new Uint8Array(1024),this._len=0,this._zlibs=[];for(let e=0;e<4;e++)this._zlibs[e]=new Cn}decodeRect(e,t,i,n,r,o,a){if(null===this._ctl){if(r.rQwait("TIGHT compression-control",1))return!1;this._ctl=r.rQshift8();for(let e=0;e<4;e++)this._ctl>>e&1&&(this._zlibs[e].reset(),s("Reset zlib stream "+e));this._ctl=this._ctl>>4}let h;if(8===this._ctl)h=this._fillRect(e,t,i,n,r,o,a);else if(9===this._ctl)h=this._jpegRect(e,t,i,n,r,o,a);else if(10===this._ctl)h=this._pngRect(e,t,i,n,r,o,a);else{if(0!=(128&this._ctl))throw Error("Illegal tight compression received (ctl: "+this._ctl+")");h=this._basicRect(this._ctl,e,t,i,n,r,o,a)}return h&&(this._ctl=null),h}_fillRect(e,t,s,i,n,r,o){if(n.rQwait("TIGHT",3))return!1;const a=n.get_rQi(),h=n.rQwhole();return r.fillRect(e,t,s,i,[h[a+2],h[a+1],h[a]],!1),n.rQskipBytes(3),!0}_jpegRect(e,t,s,i,n,r,o){let a=this._readData(n);return null!==a&&(r.imageRect(e,t,"image/jpeg",a),!0)}_pngRect(e,t,s,i,n,r,o){throw Error("PNG received in standard Tight rect")}_basicRect(e,t,s,i,n,r,o,a){if(null===this._filter)if(4&e){if(r.rQwait("TIGHT",1))return!1;this._filter=r.rQshift8()}else this._filter=0;let h,c=3&e;switch(this._filter){case 0:h=this._copyFilter(c,t,s,i,n,r,o,a);break;case 1:h=this._paletteFilter(c,t,s,i,n,r,o,a);break;case 2:h=this._gradientFilter(c,t,s,i,n,r,o,a);break;default:throw Error("Illegal tight filter received (ctl: "+this._filter+")")}return h&&(this._filter=null),h}_copyFilter(e,t,s,i,n,r,o,a){const h=i*n*3;let c;if(h<12){if(r.rQwait("TIGHT",h))return!1;c=r.rQshiftBytes(h)}else{if(c=this._readData(r),null===c)return!1;if(c=this._zlibs[e].inflate(c,!0,h),c.length!=h)throw Error("Incomplete zlib block")}return o.blitRgbImage(t,s,i,n,c,0,!1),!0}_paletteFilter(e,t,s,i,n,r,o,a){if(0===this._numColors){if(r.rQwait("TIGHT palette",1))return!1;const e=r.rQpeek8()+1,t=3*e;if(r.rQwait("TIGHT palette",1+t))return!1;this._numColors=e,r.rQskipBytes(1),r.rQshiftTo(this._palette,t)}const h=this._numColors<=2?1:8,c=Math.floor((i*h+7)/8)*n;let l;if(c<12){if(r.rQwait("TIGHT",c))return!1;l=r.rQshiftBytes(c)}else{if(l=this._readData(r),null===l)return!1;if(l=this._zlibs[e].inflate(l,!0,c),l.length!=c)throw Error("Incomplete zlib block")}return 2==this._numColors?this._monoRect(t,s,i,n,l,this._palette,o):this._paletteRect(t,s,i,n,l,this._palette,o),this._numColors=0,!0}_monoRect(e,t,s,i,n,r,o){const a=this._getScratchBuffer(s*i*4),h=Math.floor((s+7)/8),c=Math.floor(s/8);for(let e=0;e<i;e++){let t,i,o;for(o=0;o<c;o++)for(let c=7;c>=0;c--)t=4*(e*s+8*o+7-c),i=3*(n[e*h+o]>>c&1),a[t]=r[i],a[t+1]=r[i+1],a[t+2]=r[i+2],a[t+3]=255;for(let c=7;c>=8-s%8;c--)t=4*(e*s+8*o+7-c),i=3*(n[e*h+o]>>c&1),a[t]=r[i],a[t+1]=r[i+1],a[t+2]=r[i+2],a[t+3]=255}o.blitRgbxImage(e,t,s,i,a,0,!1)}_paletteRect(e,t,s,i,n,r,o){const a=this._getScratchBuffer(s*i*4),h=s*i*4;for(let e=0,t=0;e<h;e+=4,t++){const s=3*n[t];a[e]=r[s],a[e+1]=r[s+1],a[e+2]=r[s+2],a[e+3]=255}o.blitRgbxImage(e,t,s,i,a,0,!1)}_gradientFilter(e,t,s,i,n,r,o,a){throw Error("Gradient filter not implemented")}_readData(e){if(0===this._len){if(e.rQwait("TIGHT",3))return null;let t;t=e.rQshift8(),this._len=127&t,128&t&&(t=e.rQshift8(),this._len|=(127&t)<<7,128&t&&(t=e.rQshift8(),this._len|=t<<14))}if(e.rQwait("TIGHT",this._len))return null;let t=e.rQshiftBytes(this._len);return this._len=0,t}_getScratchBuffer(e){return(!this._scratchBuffer||this._scratchBuffer.length<e)&&(this._scratchBuffer=new Uint8Array(e)),this._scratchBuffer}}class Sn extends xn{_pngRect(e,t,s,i,n,r,o){let a=this._readData(n);return null!==a&&(r.imageRect(e,t,"image/png",a),!0)}_basicRect(e,t,s,i,n,r,o,a){throw Error("BasicCompression received in TightPNG rect")}}class An extends class{constructor(){this._listeners=null}addEventListener(e,t){this._listeners||(this._listeners=new Map),this._listeners.has(e)||this._listeners.set(e,new Set),this._listeners.get(e).add(t)}removeEventListener(e,t){this._listeners&&this._listeners.has(e)&&this._listeners.get(e).delete(t)}dispatchEvent(e){return!this._listeners||!this._listeners.has(e.type)||(this._listeners.get(e.type).forEach((t=>{t.call(this,e)}),this),!e.defaultPrevented)}}{constructor(e,s,r){if(!e)throw Error("Must specify target");if(!s)throw Error("Must specify URL");super(),this._target=e,this._url=s,r=r||{},this._rfb_credentials=r.credentials||{},this._shared=!("shared"in r)||!!r.shared,this._repeaterID=r.repeaterID||"",this._showDotCursor=r.showDotCursor||!1,this._rfb_connection_state="",this._rfb_init_state="",this._rfb_auth_scheme="",this._rfb_clean_disconnect=!0,this._rfb_version=0,this._rfb_max_version=3.8,this._rfb_tightvnc=!1,this._rfb_xvp_ver=0,this._fb_width=0,this._fb_height=0,this._fb_name="",this._capabilities={power:!1},this._supportsFence=!1,this._supportsContinuousUpdates=!1,this._enabledContinuousUpdates=!1,this._supportsSetDesktopSize=!1,this._screen_id=0,this._screen_flags=0,this._qemuExtKeyEventSupported=!1,this._sock=null,this._display=null,this._flushing=!1,this._keyboard=null,this._mouse=null,this._disconnTimer=null,this._resizeTimeout=null,this._decoders={},this._FBU={rects:0,x:0,y:0,width:0,height:0,encoding:null},this._mouse_buttonMask=0,this._mouse_arr=[],this._viewportDragging=!1,this._viewportDragPos={},this._viewportHasMoved=!1,this._eventHandlers={focusCanvas:this._focusCanvas.bind(this),windowResize:this._windowResize.bind(this)},t(">> RFB.constructor"),this._screen=document.createElement("div"),this._screen.style.display="flex",this._screen.style.width="100%",this._screen.style.height="100%",this._screen.style.overflow="auto",this._screen.style.backgroundColor="rgb(40, 40, 40)",this._canvas=document.createElement("canvas"),this._canvas.style.margin="auto",this._canvas.style.outline="none",this._canvas.style.flexShrink="0",this._canvas.width=0,this._canvas.height=0,this._canvas.tabIndex=-1,this._screen.appendChild(this._canvas),this._cursor=new Si,this._cursorImage=An.cursors.none,this._decoders[Li]=new Xi,this._decoders[Di]=new Yi,this._decoders[Ti]=new qi,this._decoders[Ui]=new ji,this._decoders[Mi]=new xn,this._decoders[Ri]=new Sn;try{this._display=new p(this._canvas)}catch(e){throw n("Display exception: "+e),e}this._display.onflush=this._onFlush.bind(this),this._display.clear(),this._keyboard=new Qi(this._canvas),this._keyboard.onkeyevent=this._handleKeyEvent.bind(this),this._mouse=new Ci(this._canvas),this._mouse.onmousebutton=this._handleMouseButton.bind(this),this._mouse.onmousemove=this._handleMouseMove.bind(this),this._sock=new Ei,this._sock.on("message",this._handle_message.bind(this)),this._sock.on("open",(()=>{"connecting"===this._rfb_connection_state&&""===this._rfb_init_state?(this._rfb_init_state="ProtocolVersion",t("Starting VNC handshake")):this._fail("Unexpected server connection while "+this._rfb_connection_state)})),this._sock.on("close",(e=>{t("WebSocket on-close event");let s="";switch(e.code&&(s="(code: "+e.code,e.reason&&(s+=", reason: "+e.reason),s+=")"),this._rfb_connection_state){case"connecting":this._fail("Connection closed "+s);break;case"connected":this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected");break;case"disconnecting":this._updateConnectionState("disconnected");break;case"disconnected":this._fail("Unexpected server disconnect when already disconnected "+s);break;default:this._fail("Unexpected server disconnect before connecting "+s)}this._sock.off("close")})),this._sock.on("error",(e=>i("WebSocket on-error event"))),setTimeout(this._updateConnectionState.bind(this,"connecting")),t("<< RFB.constructor"),this.dragViewport=!1,this.focusOnClick=!0,this._viewOnly=!1,this._clipViewport=!1,this._scaleViewport=!1,this._resizeSession=!1}get viewOnly(){return this._viewOnly}set viewOnly(e){this._viewOnly=e,"connecting"!==this._rfb_connection_state&&"connected"!==this._rfb_connection_state||(e?(this._keyboard.ungrab(),this._mouse.ungrab()):(this._keyboard.grab(),this._mouse.grab()))}get capabilities(){return this._capabilities}get touchButton(){return this._mouse.touchButton}set touchButton(e){this._mouse.touchButton=e}get clipViewport(){return this._clipViewport}set clipViewport(e){this._clipViewport=e,this._updateClip()}get scaleViewport(){return this._scaleViewport}set scaleViewport(e){this._scaleViewport=e,e&&this._clipViewport&&this._updateClip(),this._updateScale(),!e&&this._clipViewport&&this._updateClip()}get resizeSession(){return this._resizeSession}set resizeSession(e){this._resizeSession=e,e&&this._requestRemoteResize()}get showDotCursor(){return this._showDotCursor}set showDotCursor(e){this._showDotCursor=e,this._refreshCursor()}disconnect(){this._updateConnectionState("disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open")}sendCredentials(e){this._rfb_credentials=e,setTimeout(this._init_msg.bind(this),0)}sendCtrlAltDel(){"connected"!==this._rfb_connection_state||this._viewOnly||(s("Sending Ctrl-Alt-Del"),this.sendKey(Tt,"ControlLeft",!0),this.sendKey(Rt,"AltLeft",!0),this.sendKey(M,"Delete",!0),this.sendKey(M,"Delete",!1),this.sendKey(Rt,"AltLeft",!1),this.sendKey(Tt,"ControlLeft",!1))}machineShutdown(){this._xvpOp(1,2)}machineReboot(){this._xvpOp(1,3)}machineReset(){this._xvpOp(1,4)}sendKey(e,t,i){if("connected"!==this._rfb_connection_state||this._viewOnly)return;if(void 0===i)return this.sendKey(e,t,!0),void this.sendKey(e,t,!1);const n=Bi[t];if(this._qemuExtKeyEventSupported&&n)s("Sending key ("+(i?"down":"up")+"): keysym "+(e=e||0)+", scancode "+n),An.messages.QEMUExtendedKeyEvent(this._sock,e,i,n);else{if(!e)return;s("Sending keysym ("+(i?"down":"up")+"): "+e),An.messages.keyEvent(this._sock,e,i?1:0)}}focus(){this._canvas.focus()}blur(){this._canvas.blur()}clipboardPasteFrom(e){"connected"!==this._rfb_connection_state||this._viewOnly||An.messages.clientCutText(this._sock,e)}_connect(){t(">> RFB.connect"),s("connecting to "+this._url);try{this._sock.open(this._url,["binary"])}catch(e){"SyntaxError"===e.name?this._fail("Invalid host or port ("+e+")"):this._fail("Error when opening socket ("+e+")")}this._target.appendChild(this._screen),this._cursor.attach(this._canvas),this._refreshCursor(),window.addEventListener("resize",this._eventHandlers.windowResize),this._canvas.addEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.addEventListener("touchstart",this._eventHandlers.focusCanvas),t("<< RFB.connect")}_disconnect(){t(">> RFB.disconnect"),this._cursor.detach(),this._canvas.removeEventListener("mousedown",this._eventHandlers.focusCanvas),this._canvas.removeEventListener("touchstart",this._eventHandlers.focusCanvas),window.removeEventListener("resize",this._eventHandlers.windowResize),this._keyboard.ungrab(),this._mouse.ungrab(),this._sock.close();try{this._target.removeChild(this._screen)}catch(e){if("NotFoundError"!==e.name)throw e}clearTimeout(this._resizeTimeout),t("<< RFB.disconnect")}_focusCanvas(e){e.defaultPrevented||this.focusOnClick&&this.focus()}_windowResize(e){window.requestAnimationFrame((()=>{this._updateClip(),this._updateScale()})),this._resizeSession&&(clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(this._requestRemoteResize.bind(this),500))}_updateClip(){const e=this._display.clipViewport;let t=this._clipViewport;if(this._scaleViewport&&(t=!1),e!==t&&(this._display.clipViewport=t),t){const e=this._screenSize();this._display.viewportChangeSize(e.w,e.h),this._fixScrollbars()}}_updateScale(){if(this._scaleViewport){const e=this._screenSize();this._display.autoscale(e.w,e.h)}else this._display.scale=1;this._fixScrollbars()}_requestRemoteResize(){if(clearTimeout(this._resizeTimeout),this._resizeTimeout=null,!this._resizeSession||this._viewOnly||!this._supportsSetDesktopSize)return;const e=this._screenSize();An.messages.setDesktopSize(this._sock,Math.floor(e.w),Math.floor(e.h),this._screen_id,this._screen_flags),t("Requested new desktop size: "+e.w+"x"+e.h)}_screenSize(){let e=this._screen.getBoundingClientRect();return{w:e.width,h:e.height}}_fixScrollbars(){const e=this._screen.style.overflow;this._screen.style.overflow="hidden",this._screen.getBoundingClientRect(),this._screen.style.overflow=e}_updateConnectionState(e){const s=this._rfb_connection_state;if(e!==s)if("disconnected"!==s){switch(e){case"connected":if("connecting"!==s)return void n("Bad transition to connected state, previous connection state: "+s);break;case"disconnected":if("disconnecting"!==s)return void n("Bad transition to disconnected state, previous connection state: "+s);break;case"connecting":if(""!==s)return void n("Bad transition to connecting state, previous connection state: "+s);break;case"disconnecting":if("connected"!==s&&"connecting"!==s)return void n("Bad transition to disconnecting state, previous connection state: "+s);break;default:return void n("Unknown connection state: "+e)}switch(this._rfb_connection_state=e,t("New state '"+e+"', was '"+s+"'."),this._disconnTimer&&"disconnecting"!==e&&(t("Clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),e){case"connecting":this._connect();break;case"connected":this.dispatchEvent(new CustomEvent("connect",{detail:{}}));break;case"disconnecting":this._disconnect(),this._disconnTimer=setTimeout((()=>{n("Disconnection timed out."),this._updateConnectionState("disconnected")}),3e3);break;case"disconnected":this.dispatchEvent(new CustomEvent("disconnect",{detail:{clean:this._rfb_clean_disconnect}}))}}else n("Tried changing state of a disconnected RFB object");else t("Already in state '"+e+"', ignoring")}_fail(e){switch(this._rfb_connection_state){case"disconnecting":n("Failed when disconnecting: "+e);break;case"connected":n("Failed while connected: "+e);break;case"connecting":n("Failed when connecting: "+e);break;default:n("RFB failure: "+e)}return this._rfb_clean_disconnect=!1,this._updateConnectionState("disconnecting"),this._updateConnectionState("disconnected"),!1}_setCapability(e,t){this._capabilities[e]=t,this.dispatchEvent(new CustomEvent("capabilities",{detail:{capabilities:this._capabilities}}))}_handle_message(){if(0!==this._sock.rQlen())switch(this._rfb_connection_state){case"disconnected":n("Got data while disconnected");break;case"connected":for(;!this._flushing&&this._normal_msg()&&0!==this._sock.rQlen(););break;default:this._init_msg()}else i("handle_message called on an empty receive queue")}_handleKeyEvent(e,t,s){this.sendKey(e,t,s)}_handleMouseButton(e,t,s,i){if(s?this._mouse_buttonMask|=i:this._mouse_buttonMask&=~i,this.dragViewport){if(s&&!this._viewportDragging)return this._viewportDragging=!0,this._viewportDragPos={x:e,y:t},void(this._viewportHasMoved=!1);if(this._viewportDragging=!1,this._viewportHasMoved)return;An.messages.pointerEvent(this._sock,this._display.absX(e),this._display.absY(t),i)}this._viewOnly||"connected"===this._rfb_connection_state&&An.messages.pointerEvent(this._sock,this._display.absX(e),this._display.absY(t),this._mouse_buttonMask)}_handleMouseMove(e,t){if(this._viewportDragging){const s=this._viewportDragPos.x-e,i=this._viewportDragPos.y-t;(this._viewportHasMoved||Math.abs(s)>o||Math.abs(i)>o)&&(this._viewportHasMoved=!0,this._viewportDragPos={x:e,y:t},this._display.viewportChangePos(s,i))}else this._viewOnly||"connected"===this._rfb_connection_state&&An.messages.pointerEvent(this._sock,this._display.absX(e),this._display.absY(t),this._mouse_buttonMask)}_negotiate_protocol_version(){if(this._sock.rQlen()<12)return this._fail("Received incomplete protocol version.");const e=this._sock.rQshiftStr(12).substr(4,7);s("Server ProtocolVersion: "+e);let i=0;switch(e){case"000.000":i=1;break;case"003.003":case"003.006":case"003.889":this._rfb_version=3.3;break;case"003.007":this._rfb_version=3.7;break;case"003.008":case"004.000":case"004.001":case"005.000":this._rfb_version=3.8;break;default:return this._fail("Invalid server version "+e)}if(i){let e="ID:"+this._repeaterID;for(;e.length<250;)e+="\0";return this._sock.send_string(e),!0}this._rfb_version>this._rfb_max_version&&(this._rfb_version=this._rfb_max_version);const n="00"+parseInt(this._rfb_version,10)+".00"+10*this._rfb_version%10;this._sock.send_string("RFB "+n+"\n"),t("Sent ProtocolVersion: "+n),this._rfb_init_state="Security"}_negotiate_security(){function e(e,t){for(let s=0;s<t.length;s++)if(t[s]===e)return!0;return!1}if(this._rfb_version>=3.7){const s=this._sock.rQshift8();if(this._sock.rQwait("security type",s,1))return!1;if(0===s)return this._handle_security_failure("no security types");const i=this._sock.rQshiftBytes(s);if(t("Server security types: "+i),this._rfb_auth_scheme=0,e(1,i))this._rfb_auth_scheme=1;else if(e(22,i))this._rfb_auth_scheme=22;else if(e(16,i))this._rfb_auth_scheme=16;else{if(!e(2,i))return this._fail("Unsupported security types (types: "+i+")");this._rfb_auth_scheme=2}this._sock.send([this._rfb_auth_scheme])}else{if(this._sock.rQwait("security scheme",4))return!1;this._rfb_auth_scheme=this._sock.rQshift32()}return this._rfb_init_state="Authentication",t("Authenticating using scheme: "+this._rfb_auth_scheme),this._init_msg()}_handle_security_failure(e,t){if(e=void 0===e?"":" on "+e,void 0===t&&(t=1),this._sock.rQwait("reason length",4))return!1;const s=this._sock.rQshift32();let i="";if(s>0){if(this._sock.rQwait("reason",s,8))return!1;i=this._sock.rQshiftStr(s)}return""!==i?(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:t,reason:i}})),this._fail("Security negotiation failed"+e+" (reason: "+i+")")):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:t}})),this._fail("Security negotiation failed"+e))}_negotiate_xvp_auth(){if(!this._rfb_credentials.username||!this._rfb_credentials.password||!this._rfb_credentials.target)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["username","password","target"]}})),!1;const e=String.fromCharCode(this._rfb_credentials.username.length)+String.fromCharCode(this._rfb_credentials.target.length)+this._rfb_credentials.username+this._rfb_credentials.target;return this._sock.send_string(e),this._rfb_auth_scheme=2,this._negotiate_authentication()}_negotiate_std_vnc_auth(){if(this._sock.rQwait("auth challenge",16))return!1;if(!this._rfb_credentials.password)return this.dispatchEvent(new CustomEvent("credentialsrequired",{detail:{types:["password"]}})),!1;const e=Array.prototype.slice.call(this._sock.rQshiftBytes(16)),t=An.genDES(this._rfb_credentials.password,e);return this._sock.send(t),this._rfb_init_state="SecurityResult",!0}_negotiate_tight_tunnels(e){const s={vendor:"TGHT",signature:"NOTUNNEL"},i={};for(let t=0;t<e;t++){const e=this._sock.rQshift32(),t=this._sock.rQshiftStr(4),s=this._sock.rQshiftStr(8);i[e]={vendor:t,signature:s}}return t("Server Tight tunnel types: "+i),i[1]&&"SICR"===i[1].vendor&&"SCHANNEL"===i[1].signature&&(t("Detected Siemens server. Assuming NOTUNNEL support."),i[0]={vendor:"TGHT",signature:"NOTUNNEL"}),i[0]?i[0].vendor!=s.vendor||i[0].signature!=s.signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(t("Selected tunnel type: "+s),this._sock.send([0,0,0,0]),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")}_negotiate_tight_auth(){if(!this._rfb_tightvnc){if(this._sock.rQwait("num tunnels",4))return!1;const e=this._sock.rQshift32();if(e>0&&this._sock.rQwait("tunnel capabilities",16*e,4))return!1;if(this._rfb_tightvnc=!0,e>0)return this._negotiate_tight_tunnels(e),!1}if(this._sock.rQwait("sub auth count",4))return!1;const e=this._sock.rQshift32();if(0===e)return this._rfb_init_state="SecurityResult",!0;if(this._sock.rQwait("sub auth capabilities",16*e,4))return!1;const s={STDVNOAUTH__:1,STDVVNCAUTH_:2},i=[];for(let t=0;t<e;t++){this._sock.rQshift32();const e=this._sock.rQshiftStr(12);i.push(e)}t("Server Tight authentication types: "+i);for(let e in s)if(-1!=i.indexOf(e))switch(this._sock.send([0,0,0,s[e]]),t("Selected authentication type: "+e),e){case"STDVNOAUTH__":return this._rfb_init_state="SecurityResult",!0;case"STDVVNCAUTH_":return this._rfb_auth_scheme=2,this._init_msg();default:return this._fail("Unsupported tiny auth scheme (scheme: "+e+")")}return this._fail("No supported sub-auth types!")}_negotiate_authentication(){switch(this._rfb_auth_scheme){case 0:return this._handle_security_failure("authentication scheme");case 1:return this._rfb_version>=3.8?(this._rfb_init_state="SecurityResult",!0):(this._rfb_init_state="ClientInitialisation",this._init_msg());case 22:return this._negotiate_xvp_auth();case 2:return this._negotiate_std_vnc_auth();case 16:return this._negotiate_tight_auth();default:return this._fail("Unsupported auth scheme (scheme: "+this._rfb_auth_scheme+")")}}_handle_security_result(){if(this._sock.rQwait("VNC auth response ",4))return!1;const e=this._sock.rQshift32();return 0===e?(this._rfb_init_state="ClientInitialisation",t("Authentication OK"),this._init_msg()):this._rfb_version>=3.8?this._handle_security_failure("security result",e):(this.dispatchEvent(new CustomEvent("securityfailure",{detail:{status:e}})),this._fail("Security handshake failed"))}_negotiate_server_init(){if(this._sock.rQwait("server initialization",24))return!1;const e=this._sock.rQshift16(),t=this._sock.rQshift16(),n=this._sock.rQshift8(),r=this._sock.rQshift8(),o=this._sock.rQshift8(),a=this._sock.rQshift8(),h=this._sock.rQshift16(),c=this._sock.rQshift16(),l=this._sock.rQshift16(),_=this._sock.rQshift8(),d=this._sock.rQshift8(),u=this._sock.rQshift8();this._sock.rQskipBytes(3);const f=this._sock.rQshift32();if(this._sock.rQwait("server init name",f,24))return!1;var p;if(this._fb_name=(p=this._sock.rQshiftStr(f),decodeURIComponent(escape(p))),this._rfb_tightvnc){if(this._sock.rQwait("TightVNC extended server init header",8,24+f))return!1;const e=this._sock.rQshift16(),t=this._sock.rQshift16(),s=this._sock.rQshift16();this._sock.rQskipBytes(2);const i=16*(e+t+s);if(this._sock.rQwait("TightVNC extended server init header",i,32+f))return!1;this._sock.rQskipBytes(16*e),this._sock.rQskipBytes(16*t),this._sock.rQskipBytes(16*s)}return s("Screen: "+e+"x"+t+", bpp: "+n+", depth: "+r+", big_endian: "+o+", true_color: "+a+", red_max: "+h+", green_max: "+c+", blue_max: "+l+", red_shift: "+_+", green_shift: "+d+", blue_shift: "+u),0!==o&&i("Server native endian is not little endian"),16!==_&&i("Server native red-shift is not 16"),0!==u&&i("Server native blue-shift is not 0"),this.dispatchEvent(new CustomEvent("desktopname",{detail:{name:this._fb_name}})),this._resize(e,t),this._viewOnly||this._keyboard.grab(),this._viewOnly||this._mouse.grab(),this._fb_depth=24,"Intel(r) AMT KVM"===this._fb_name&&(i("Intel AMT KVM only supports 8/16 bit depths. Using low color mode."),this._fb_depth=8),An.messages.pixelFormat(this._sock,this._fb_depth,!0),this._sendEncodings(),An.messages.fbUpdateRequest(this._sock,!1,0,0,this._fb_width,this._fb_height),this._updateConnectionState("connected"),!0}_sendEncodings(){const e=[];e.push(Di),24==this._fb_depth&&(e.push(Mi),e.push(Ri),e.push(Ui),e.push(Ti)),e.push(Li),e.push(Ii+6),e.push(Gi+2),e.push(Pi),e.push(Hi),e.push(Ni),e.push(zi),e.push(Vi),e.push(Oi),e.push(Wi),24==this._fb_depth&&e.push(Ki),An.messages.clientEncodings(this._sock,e)}_init_msg(){switch(this._rfb_init_state){case"ProtocolVersion":return this._negotiate_protocol_version();case"Security":return this._negotiate_security();case"Authentication":return this._negotiate_authentication();case"SecurityResult":return this._handle_security_result();case"ClientInitialisation":return this._sock.send([this._shared?1:0]),this._rfb_init_state="ServerInitialisation",!0;case"ServerInitialisation":return this._negotiate_server_init();default:return this._fail("Unknown init state (state: "+this._rfb_init_state+")")}}_handle_set_colour_map_msg(){return t("SetColorMapEntries"),this._fail("Unexpected SetColorMapEntries message")}_handle_server_cut_text(){if(t("ServerCutText"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);const e=this._sock.rQshift32();if(this._sock.rQwait("ServerCutText",e,8))return!1;const s=this._sock.rQshiftStr(e);return this._viewOnly||this.dispatchEvent(new CustomEvent("clipboard",{detail:{text:s}})),!0}_handle_server_fence_msg(){if(this._sock.rQwait("ServerFence header",8,1))return!1;this._sock.rQskipBytes(3);let e=this._sock.rQshift32(),t=this._sock.rQshift8();if(this._sock.rQwait("ServerFence payload",t,9))return!1;t>64&&(i("Bad payload length ("+t+") in fence response"),t=64);const s=this._sock.rQshiftStr(t);return this._supportsFence=!0,e&1<<31?(e&=3,An.messages.clientFence(this._sock,e,s),!0):this._fail("Unexpected fence response")}_handle_xvp_msg(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskip8();const e=this._sock.rQshift8(),t=this._sock.rQshift8();switch(t){case 0:n("XVP Operation Failed");break;case 1:this._rfb_xvp_ver=e,s("XVP extensions enabled (version "+this._rfb_xvp_ver+")"),this._setCapability("power",!0);break;default:this._fail("Illegal server XVP message (msg: "+t+")")}return!0}_normal_msg(){let e,i,n;switch(e=this._FBU.rects>0?0:this._sock.rQshift8(),e){case 0:return n=this._framebufferUpdate(),n&&!this._enabledContinuousUpdates&&An.messages.fbUpdateRequest(this._sock,!0,0,0,this._fb_width,this._fb_height),n;case 1:return this._handle_set_colour_map_msg();case 2:return t("Bell"),this.dispatchEvent(new CustomEvent("bell",{detail:{}})),!0;case 3:return this._handle_server_cut_text();case 150:return i=!this._supportsContinuousUpdates,this._supportsContinuousUpdates=!0,this._enabledContinuousUpdates=!1,i&&(this._enabledContinuousUpdates=!0,this._updateContinuousUpdates(),s("Enabling continuous updates.")),!0;case 248:return this._handle_server_fence_msg();case 250:return this._handle_xvp_msg();default:return this._fail("Unexpected server message (type "+e+")"),t("sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0}}_onFlush(){this._flushing=!1,this._sock.rQlen()>0&&this._handle_message()}_framebufferUpdate(){if(0===this._FBU.rects){if(this._sock.rQwait("FBU header",3,1))return!1;if(this._sock.rQskip8(),this._FBU.rects=this._sock.rQshift16(),this._display.pending())return this._flushing=!0,this._display.flush(),!1}for(;this._FBU.rects>0;){if(null===this._FBU.encoding){if(this._sock.rQwait("rect header",12))return!1;const e=this._sock.rQshiftBytes(12);this._FBU.x=(e[0]<<8)+e[1],this._FBU.y=(e[2]<<8)+e[3],this._FBU.width=(e[4]<<8)+e[5],this._FBU.height=(e[6]<<8)+e[7],this._FBU.encoding=parseInt((e[8]<<24)+(e[9]<<16)+(e[10]<<8)+e[11],10)}if(!this._handleRect())return!1;this._FBU.rects--,this._FBU.encoding=null}return this._display.flip(),!0}_handleRect(){switch(this._FBU.encoding){case Hi:return this._FBU.rects=1,!0;case Ki:return this._handleCursor();case Ni:try{void 0!==document.createEvent("keyboardEvent").code&&(this._qemuExtKeyEventSupported=!0)}catch(e){}return!0;case Pi:return this._resize(this._FBU.width,this._FBU.height),!0;case zi:return this._handleExtendedDesktopSize();default:return this._handleDataRect()}}_handleCursor(){const e=this._FBU.x,t=this._FBU.y,s=this._FBU.width,i=this._FBU.height,n=s*i*4,r=Math.ceil(s/8)*i;let o=n+r;if(this._sock.rQwait("cursor encoding",o))return!1;const a=this._sock.rQshiftBytes(n),h=this._sock.rQshiftBytes(r);let c=new Uint8Array(s*i*4),l=0;for(let e=0;e<i;e++)for(let t=0;t<s;t++){let i=h[e*Math.ceil(s/8)+Math.floor(t/8)]<<t%8&128?255:0;c[l]=a[l+2],c[l+1]=a[l+1],c[l+2]=a[l],c[l+3]=i,l+=4}return this._updateCursor(c,e,t,s,i),!0}_handleExtendedDesktopSize(){if(this._sock.rQwait("ExtendedDesktopSize",4))return!1;const e=this._sock.rQpeek8();let t=4+16*e;if(this._sock.rQwait("ExtendedDesktopSize",t))return!1;const s=!this._supportsSetDesktopSize;this._supportsSetDesktopSize=!0,s&&this._requestRemoteResize(),this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(let t=0;t<e;t+=1)0===t?(this._screen_id=this._sock.rQshiftBytes(4),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screen_flags=this._sock.rQshiftBytes(4)):this._sock.rQskipBytes(16);if(1===this._FBU.x&&0!==this._FBU.y){let e="";switch(this._FBU.y){case 1:e="Resize is administratively prohibited";break;case 2:e="Out of resources";break;case 3:e="Invalid screen layout";break;default:e="Unknown reason"}i("Server did not accept the resize request: "+e)}else this._resize(this._FBU.width,this._FBU.height);return!0}_handleDataRect(){let e=this._decoders[this._FBU.encoding];if(!e)return this._fail("Unsupported encoding (encoding: "+this._FBU.encoding+")"),!1;try{return e.decodeRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,this._sock,this._display,this._fb_depth)}catch(e){return this._fail("Error decoding rect: "+e),!1}}_updateContinuousUpdates(){this._enabledContinuousUpdates&&An.messages.enableContinuousUpdates(this._sock,!0,0,0,this._fb_width,this._fb_height)}_resize(e,t){this._fb_width=e,this._fb_height=t,this._display.resize(this._fb_width,this._fb_height),this._updateClip(),this._updateScale(),this._updateContinuousUpdates()}_xvpOp(e,t){this._rfb_xvp_ver<e||(s("Sending XVP operation "+t+" (version "+e+")"),An.messages.xvpOp(this._sock,e,t))}_updateCursor(e,t,s,i,n){this._cursorImage={rgbaPixels:e,hotx:t,hoty:s,w:i,h:n},this._refreshCursor()}_shouldShowDotCursor(){if(!this._showDotCursor)return!1;for(let e=3;e<this._cursorImage.rgbaPixels.length;e+=4)if(this._cursorImage.rgbaPixels[e])return!1;return!0}_refreshCursor(){const e=this._shouldShowDotCursor()?An.cursors.dot:this._cursorImage;this._cursor.change(e.rgbaPixels,e.hotx,e.hoty,e.w,e.h)}static genDES(e,t){const s=[];for(let t=0;t<e.length;t++)s.push(e.charCodeAt(t));return new Fi(s).encrypt(t)}}return An.messages={keyEvent(e,t,s){const i=e._sQ,n=e._sQlen;i[n]=4,i[n+1]=s,i[n+2]=0,i[n+3]=0,i[n+4]=t>>24,i[n+5]=t>>16,i[n+6]=t>>8,i[n+7]=t,e._sQlen+=8,e.flush()},QEMUExtendedKeyEvent(e,t,s,i){const n=e._sQ,r=e._sQlen;n[r]=255,n[r+1]=0,n[r+2]=s>>8,n[r+3]=s,n[r+4]=t>>24,n[r+5]=t>>16,n[r+6]=t>>8,n[r+7]=t;const o=function(e){const t=255&i;return 224===i>>8&&t<127?128|t:e}(i);n[r+8]=o>>24,n[r+9]=o>>16,n[r+10]=o>>8,n[r+11]=o,e._sQlen+=12,e.flush()},pointerEvent(e,t,s,i){const n=e._sQ,r=e._sQlen;n[r]=5,n[r+1]=i,n[r+2]=t>>8,n[r+3]=t,n[r+4]=s>>8,n[r+5]=s,e._sQlen+=6,e.flush()},clientCutText(e,t){const s=e._sQ,i=e._sQlen;s[i]=6,s[i+1]=0,s[i+2]=0,s[i+3]=0;let n=t.length;s[i+4]=n>>24,s[i+5]=n>>16,s[i+6]=n>>8,s[i+7]=n,e._sQlen+=8;let r=0,o=n;for(;o>0;){let i=Math.min(o,e._sQbufferSize-e._sQlen);if(i<=0){this._fail("Clipboard contents could not be sent");break}for(let n=0;n<i;n++)s[e._sQlen+n]=t.charCodeAt(r+n);e._sQlen+=i,e.flush(),o-=i,r+=i}},setDesktopSize(e,t,s,i,n){const r=e._sQ,o=e._sQlen;r[o]=251,r[o+1]=0,r[o+2]=t>>8,r[o+3]=t,r[o+4]=s>>8,r[o+5]=s,r[o+6]=1,r[o+7]=0,r[o+8]=i>>24,r[o+9]=i>>16,r[o+10]=i>>8,r[o+11]=i,r[o+12]=0,r[o+13]=0,r[o+14]=0,r[o+15]=0,r[o+16]=t>>8,r[o+17]=t,r[o+18]=s>>8,r[o+19]=s,r[o+20]=n>>24,r[o+21]=n>>16,r[o+22]=n>>8,r[o+23]=n,e._sQlen+=24,e.flush()},clientFence(e,t,s){const i=e._sQ,n=e._sQlen;i[n]=248,i[n+1]=0,i[n+2]=0,i[n+3]=0,i[n+4]=t>>24,i[n+5]=t>>16,i[n+6]=t>>8,i[n+7]=t;const r=s.length;i[n+8]=r;for(let e=0;e<r;e++)i[n+9+e]=s.charCodeAt(e);e._sQlen+=9+r,e.flush()},enableContinuousUpdates(e,t,s,i,n,r){const o=e._sQ,a=e._sQlen;o[a]=150,o[a+1]=t,o[a+2]=s>>8,o[a+3]=s,o[a+4]=i>>8,o[a+5]=i,o[a+6]=n>>8,o[a+7]=n,o[a+8]=r>>8,o[a+9]=r,e._sQlen+=10,e.flush()},pixelFormat(e,t,s){const i=e._sQ,n=e._sQlen;let r;r=t>16?32:t>8?16:8;const o=Math.floor(t/3);i[n]=0,i[n+1]=0,i[n+2]=0,i[n+3]=0,i[n+4]=r,i[n+5]=t,i[n+6]=0,i[n+7]=s?1:0,i[n+8]=0,i[n+9]=(1<<o)-1,i[n+10]=0,i[n+11]=(1<<o)-1,i[n+12]=0,i[n+13]=(1<<o)-1,i[n+14]=2*o,i[n+15]=1*o,i[n+16]=0*o,i[n+17]=0,i[n+18]=0,i[n+19]=0,e._sQlen+=20,e.flush()},clientEncodings(e,t){const s=e._sQ,i=e._sQlen;s[i]=2,s[i+1]=0,s[i+2]=t.length>>8,s[i+3]=t.length;let n=i+4;for(let e=0;e<t.length;e++){const i=t[e];s[n]=i>>24,s[n+1]=i>>16,s[n+2]=i>>8,s[n+3]=i,n+=4}e._sQlen+=n-i,e.flush()},fbUpdateRequest(e,t,s,i,n,r){const o=e._sQ,a=e._sQlen;void 0===s&&(s=0),void 0===i&&(i=0),o[a]=3,o[a+1]=t?1:0,o[a+2]=s>>8&255,o[a+3]=255&s,o[a+4]=i>>8&255,o[a+5]=255&i,o[a+6]=n>>8&255,o[a+7]=255&n,o[a+8]=r>>8&255,o[a+9]=255&r,e._sQlen+=10,e.flush()},xvpOp(e,t,s){const i=e._sQ,n=e._sQlen;i[n]=250,i[n+1]=0,i[n+2]=t,i[n+3]=s,e._sQlen+=4,e.flush()}},An.cursors={none:{rgbaPixels:new Uint8Array,w:0,h:0,hotx:0,hoty:0},dot:{rgbaPixels:new Uint8Array([255,255,255,255,0,0,0,255,255,255,255,255,0,0,0,255,0,0,0,0,0,0,0,255,255,255,255,255,0,0,0,255,255,255,255,255]),w:3,h:3,hotx:1,hoty:1}},An}();
